<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Template-Driven HTTP CONNECT Proxying for TCP</title>
<meta content="Benjamin M. Schwartz" name="author">
<meta content="
       TCP proxying using HTTP CONNECT has long been part of the core HTTP specification.  However, this proxying functionality has several important deficiencies in modern HTTP environments.  This specification defines an alternative HTTP proxy service configuration for TCP connections.  This configuration is described by a URI Template, similar to the CONNECT-UDP and CONNECT-IP protocols. 
    " name="description">
<meta content="xml2rfc 3.29.0" name="generator">
<meta content="draft-ietf-httpbis-connect-tcp-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.29.0
    Python 3.12.11
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.6
    lxml 5.3.1
    platformdirs 4.3.8
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.4
    setuptools 80.9.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-httpbis-connect-tcp.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Templated CONNECT-TCP</td>
<td class="right">June 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Schwartz</td>
<td class="center">Expires 29 December 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">httpbis</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-httpbis-connect-tcp-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-06-27" class="published">27 June 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-12-29">29 December 2025</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">B. M. Schwartz</div>
<div class="org">Meta Platforms, Inc.</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Template-Driven HTTP CONNECT Proxying for TCP</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">TCP proxying using HTTP CONNECT has long been part of the core HTTP specification.  However, this proxying functionality has several important deficiencies in modern HTTP environments.  This specification defines an alternative HTTP proxy service configuration for TCP connections.  This configuration is described by a URI Template, similar to the CONNECT-UDP and CONNECT-IP protocols.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 29 December 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-history" class="internal xref">History</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-problems" class="internal xref">Problems</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1" class="keepWithNext"><a href="#section-1.3" class="auto internal xref">1.3</a>.  <a href="#name-overview" class="internal xref">Overview</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-specification" class="internal xref">Specification</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-in-http-11" class="internal xref">In HTTP/1.1</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-in-http-2-and-http-3" class="internal xref">In HTTP/2 and HTTP/3</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-use-of-other-relevant-heade" class="internal xref">Use of Other Relevant Headers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.1">
                    <p id="section-toc.1-1.3.2.3.2.1.1"><a href="#section-3.3.1" class="auto internal xref">3.3.1</a>.  <a href="#name-origin-scoped-headers" class="internal xref">Origin-scoped Headers</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.2">
                    <p id="section-toc.1-1.3.2.3.2.2.1"><a href="#section-3.3.2" class="auto internal xref">3.3.2</a>.  <a href="#name-authentication-headers" class="internal xref">Authentication Headers</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="auto internal xref">3.4</a>.  <a href="#name-closing-connections" class="internal xref">Closing Connections</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-additional-connection-setup" class="internal xref">Additional Connection Setup Behaviors</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-latency-optimizations" class="internal xref">Latency optimizations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-conveying-metadata" class="internal xref">Conveying metadata</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-applicability" class="internal xref">Applicability</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-servers" class="internal xref">Servers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-clients" class="internal xref">Clients</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-resource-exhaustion-attacks" class="internal xref">Resource Exhaustion attacks</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-operational-considerations" class="internal xref">Operational Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-avoiding-http-11" class="internal xref">Avoiding HTTP/1.1</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-gateway-compatibility" class="internal xref">Gateway Compatibility</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-new-upgrade-token" class="internal xref">New Upgrade Token</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-new-masque-default-template" class="internal xref">New MASQUE Default Template</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-new-capsule-type" class="internal xref">New Capsule Type</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<div id="history">
<section id="section-1.1">
        <h3 id="name-history">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-history" class="section-name selfRef">History</a>
        </h3>
<p id="section-1.1-1">HTTP has used the CONNECT method for proxying TCP connections since HTTP/1.1.  When using CONNECT, the request target specifies a host and port number, and the proxy forwards TCP payloads between the client and this destination (<span>[<a href="#RFC9110" class="cite xref">RFC9110</a>], <a href="https://rfc-editor.org/rfc/rfc9110#section-9.3.6" class="relref">Section 9.3.6</a></span>).  To date, this is the only mechanism defined for proxying TCP over HTTP.  In this specification, this is referred to as a "classic HTTP CONNECT proxy".<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">HTTP/3 uses a UDP transport, so it cannot be forwarded using the pre-existing CONNECT mechanism.  To enable forward proxying of HTTP/3, the MASQUE effort has defined proxy mechanisms that are capable of proxying UDP datagrams <span>[<a href="#CONNECT-UDP" class="cite xref">CONNECT-UDP</a>]</span>, and more generally IP datagrams <span>[<a href="#CONNECT-IP" class="cite xref">CONNECT-IP</a>]</span>.  The destination host and port number (if applicable) are encoded into the HTTP resource path, and end-to-end datagrams are wrapped into HTTP Datagrams <span>[<a href="#RFC9297" class="cite xref">RFC9297</a>]</span> on the client-proxy path.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="problems">
<section id="section-1.2">
        <h3 id="name-problems">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-problems" class="section-name selfRef">Problems</a>
        </h3>
<p id="section-1.2-1">HTTP clients can be configured to use proxies by selecting a proxy hostname, a port, and whether to use a security protocol. However, Classic HTTP CONNECT requests using the proxy do not carry this configuration information. Instead, they only indicate the hostname and port of the target. This prevents any HTTP server from hosting multiple distinct proxy services, as the server cannot distinguish them by path (as with distinct resources) or by origin (as in "virtual hosting").<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.2-2">The absence of an explicit origin for the proxy also rules out the usual defenses against server port misdirection attacks (see <span><a href="https://rfc-editor.org/rfc/rfc9110#section-7.4" class="relref">Section 7.4</a> of [<a href="#RFC9110" class="cite xref">RFC9110</a>]</span>) and creates ambiguity about the use of origin-scoped response header fields (e.g., "Alt-Svc" <span>[<a href="#RFC7838" class="cite xref">RFC7838</a>]</span>, "Strict-Transport-Security" <span>[<a href="#RFC6797" class="cite xref">RFC6797</a>]</span>).<a href="#section-1.2-2" class="pilcrow">¶</a></p>
<p id="section-1.2-3">Classic HTTP CONNECT requests cannot carry in-stream metadata. For example, the WRAP_UP capsule <span>[<a href="#I-D.schinazi-httpbis-wrap-up" class="cite xref">I-D.schinazi-httpbis-wrap-up</a>]</span> cannot be used with Classic HTTP CONNECT.<a href="#section-1.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="overview">
<section id="section-1.3">
        <h3 id="name-overview">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
        </h3>
<p id="section-1.3-1">This specification describes an alternative mechanism for proxying TCP in HTTP.  Like <span>[<a href="#CONNECT-UDP" class="cite xref">CONNECT-UDP</a>]</span> and <span>[<a href="#CONNECT-IP" class="cite xref">CONNECT-IP</a>]</span>, the proxy service is identified by a URI Template.  Proxy interactions reuse standard HTTP components and semantics, avoiding changes to the core HTTP protocol.<a href="#section-1.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="specification">
<section id="section-3">
      <h2 id="name-specification">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-specification" class="section-name selfRef">Specification</a>
      </h2>
<p id="section-3-1">A template-driven TCP transport proxy for HTTP is identified by a URI Template <span>[<a href="#RFC6570" class="cite xref">RFC6570</a>]</span> containing variables named "target_host" and "target_port".  This URI Template and its variable values <span class="bcp14">MUST</span> meet all the same requirements as for UDP proxying (<span>[<a href="#RFC9298" class="cite xref">RFC9298</a>], <a href="https://rfc-editor.org/rfc/rfc9298#section-2" class="relref">Section 2</a></span>), and are subject to the same validation rules.  The client <span class="bcp14">MUST</span> substitute the destination host and port number into this template to produce the request URI.  The derived URI serves as the destination of a Capsule Protocol connection using the Upgrade Token "connect-tcp" (see registration in <a href="#new-upgrade-token" class="auto internal xref">Section 8.1</a>).<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">When using "connect-tcp", TCP payload data is sent in the payload of new Capsule Types named DATA and FINAL_DATA (see registrations in <a href="#data-capsule" class="auto internal xref">Section 8.3</a>).  The ordered concatenation of these capsule payloads represents the TCP payload data.  A FINAL_DATA capsule additionally indicates that the sender has closed this stream, semantically equivalent to TCP FIN.  After sending a FINAL_DATA capsule, an endpoint <span class="bcp14">MUST NOT</span> send any more DATA or FINAL_DATA capsules on this data stream. (See <a href="#closing-connections" class="auto internal xref">Section 3.4</a> for related requirements.)<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">An intermediary <span class="bcp14">MAY</span> merge and split successive DATA and FINAL_DATA capsules, subject to the following requirements:<a href="#section-3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-4.1">
          <p id="section-3-4.1.1">There are no intervening capsules of other types.<a href="#section-3-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-4.2">
          <p id="section-3-4.2.1">The order of payload content is preserved.<a href="#section-3-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-4.3">
          <p id="section-3-4.3.1">The final emitted capsule uses the same capsule type (DATA or FINAL_DATA) as the final input capsule, and all others use the DATA capsule type.<a href="#section-3-4.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<div id="in-http11">
<section id="section-3.1">
        <h3 id="name-in-http-11">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-in-http-11" class="section-name selfRef">In HTTP/1.1</a>
        </h3>
<p id="section-3.1-1">In HTTP/1.1, the client uses the proxy by issuing a request as follows:<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-2.1">
            <p id="section-3.1-2.1.1">The method <span class="bcp14">SHALL</span> be "GET".<a href="#section-3.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-2.2">
            <p id="section-3.1-2.2.1">The request's target <span class="bcp14">SHALL</span> correspond to the URI derived from expansion of the proxy's URI Template.<a href="#section-3.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-2.3">
            <p id="section-3.1-2.3.1">The request <span class="bcp14">SHALL</span> include a single "Host" header field containing the origin of the proxy.<a href="#section-3.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-2.4">
            <p id="section-3.1-2.4.1">The request <span class="bcp14">SHALL</span> include a "Connection" header field with the value "Upgrade".  (Note that this requirement is case-insensitive as per <span><a href="https://rfc-editor.org/rfc/rfc9110#section-7.6.1" class="relref">Section 7.6.1</a> of [<a href="#RFC9110" class="cite xref">RFC9110</a>]</span>.)<a href="#section-3.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-2.5">
            <p id="section-3.1-2.5.1">The request <span class="bcp14">SHALL</span> include an "Upgrade" header field with the value "connect-tcp".<a href="#section-3.1-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-2.6">
            <p id="section-3.1-2.6.1">The request <span class="bcp14">SHOULD</span> include a "Capsule-Protocol: ?1" header.<a href="#section-3.1-2.6.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.1-3">If the request is well-formed and permissible, the proxy <span class="bcp14">MUST</span> attempt to establish the TCP connection before sending any response status code other than "100 (Continue)" (see <a href="#conveying-metadata" class="auto internal xref">Section 4.2</a>).  If the TCP connection is successful, the response <span class="bcp14">SHALL</span> be as follows:<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-4.1">
            <p id="section-3.1-4.1.1">The HTTP status code <span class="bcp14">SHALL</span> be "101 (Switching Protocols)".<a href="#section-3.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.2">
            <p id="section-3.1-4.2.1">The response <span class="bcp14">SHALL</span> include a "Connection" header field with the value "Upgrade".<a href="#section-3.1-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.3">
            <p id="section-3.1-4.3.1">The response <span class="bcp14">SHALL</span> include a single "Upgrade" header field with the value "connect-tcp".<a href="#section-3.1-4.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.4">
            <p id="section-3.1-4.4.1">The response <span class="bcp14">SHOULD</span> include a "Capsule-Protocol: ?1" header.<a href="#section-3.1-4.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.1-5">If the request is malformed or impermissible, the proxy <span class="bcp14">MUST</span> return a 4XX error code.  If a TCP connection was not established, the proxy <span class="bcp14">MUST NOT</span> switch protocols to "connect-tcp", and the client <span class="bcp14">MAY</span> reuse this connection for additional HTTP requests.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<span id="name-templated-tcp-proxy-example"></span><figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-3.1-6.1">
<pre>
Client                                                 Proxy

GET /proxy?target_host=192.0.2.1&amp;target_port=443 HTTP/1.1
Host: example.com
Connection: Upgrade
Upgrade: connect-tcp
Capsule-Protocol: ?1

** Proxy establishes a TCP connection to 192.0.2.1:443 **

                            HTTP/1.1 101 Switching Protocols
                            Connection: Upgrade
                            Upgrade: connect-tcp
                            Capsule-Protocol: ?1
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-templated-tcp-proxy-example" class="selfRef">Templated TCP proxy example in HTTP/1.1</a>
          </figcaption></figure>
</section>
</div>
<div id="in-http2-and-http3">
<section id="section-3.2">
        <h3 id="name-in-http-2-and-http-3">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-in-http-2-and-http-3" class="section-name selfRef">In HTTP/2 and HTTP/3</a>
        </h3>
<p id="section-3.2-1">In HTTP/2 and HTTP/3, the proxy <span class="bcp14">MUST</span> include SETTINGS_ENABLE_CONNECT_PROTOCOL in its SETTINGS frame <span>[<a href="#RFC8441" class="cite xref">RFC8441</a>]</span><span>[<a href="#RFC9220" class="cite xref">RFC9220</a>]</span>.  The client uses the proxy by issuing an "extended CONNECT" request as follows:<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-2.1">
            <p id="section-3.2-2.1.1">The :method pseudo-header field <span class="bcp14">SHALL</span> be "CONNECT".<a href="#section-3.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-2.2">
            <p id="section-3.2-2.2.1">The :protocol pseudo-header field <span class="bcp14">SHALL</span> be "connect-tcp".<a href="#section-3.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-2.3">
            <p id="section-3.2-2.3.1">The :authority pseudo-header field <span class="bcp14">SHALL</span> contain the authority of the proxy.<a href="#section-3.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-2.4">
            <p id="section-3.2-2.4.1">The :path and :scheme pseudo-header fields <span class="bcp14">SHALL</span> contain the path and scheme of the request URI derived from the proxy's URI Template.<a href="#section-3.2-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.2-3">A templated TCP proxying request that does not conform to all of these requirements represents a client error (see <span>[<a href="#RFC9110" class="cite xref">RFC9110</a>], <a href="https://rfc-editor.org/rfc/rfc9110#section-15.5" class="relref">Section 15.5</a></span>) and may be malformed (see <span><a href="https://rfc-editor.org/rfc/rfc9113#section-8.1.1" class="relref">Section 8.1.1</a> of [<a href="#RFC9113" class="cite xref">RFC9113</a>]</span> and <span><a href="https://rfc-editor.org/rfc/rfc9114#section-4.1.2" class="relref">Section 4.1.2</a> of [<a href="#RFC9114" class="cite xref">RFC9114</a>]</span>).<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<span id="name-templated-tcp-proxy-example-"></span><figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-3.2-4.1">
<pre>
HEADERS
:method = CONNECT
:scheme = https
:authority = request-proxy.example
:path = /proxy?target_host=2001%3Adb8%3A%3A1&amp;target_port=443
:protocol = connect-tcp
capsule-protocol = ?1
...
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-templated-tcp-proxy-example-" class="selfRef">Templated TCP proxy example in HTTP/2</a>
          </figcaption></figure>
</section>
</div>
<div id="use-of-other-relevant-headers">
<section id="section-3.3">
        <h3 id="name-use-of-other-relevant-heade">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-use-of-other-relevant-heade" class="section-name selfRef">Use of Other Relevant Headers</a>
        </h3>
<div id="origin-scoped-headers">
<section id="section-3.3.1">
          <h4 id="name-origin-scoped-headers">
<a href="#section-3.3.1" class="section-number selfRef">3.3.1. </a><a href="#name-origin-scoped-headers" class="section-name selfRef">Origin-scoped Headers</a>
          </h4>
<p id="section-3.3.1-1">Ordinary HTTP headers apply only to the single resource identified in the request or response.  An origin-scoped HTTP header is a special response header that is intended to change the client's behavior for subsequent requests to any resource on this origin.<a href="#section-3.3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.3.1-2">Unlike classic HTTP CONNECT proxies, a templated TCP proxy has an unambiguous origin of its own.  Origin-scoped headers apply to this origin when they are associated with a templated TCP proxy response.  Here are some origin-scoped headers that could potentially be sent by a templated TCP proxy:<a href="#section-3.3.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.1-3.1">
              <p id="section-3.3.1-3.1.1">"Alt-Svc" <span>[<a href="#RFC7838" class="cite xref">RFC7838</a>]</span><a href="#section-3.3.1-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.3.1-3.2">
              <p id="section-3.3.1-3.2.1">"Strict-Transport-Security" <span>[<a href="#RFC6797" class="cite xref">RFC6797</a>]</span><a href="#section-3.3.1-3.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.3.1-3.3">
              <p id="section-3.3.1-3.3.1">"Public-Key-Pins" <span>[<a href="#RFC7469" class="cite xref">RFC7469</a>]</span><a href="#section-3.3.1-3.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.3.1-3.4">
              <p id="section-3.3.1-3.4.1">"Accept-CH" <span>[<a href="#RFC8942" class="cite xref">RFC8942</a>]</span><a href="#section-3.3.1-3.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.3.1-3.5">
              <p id="section-3.3.1-3.5.1">"Set-Cookie" <span>[<a href="#RFC6265" class="cite xref">RFC6265</a>]</span>, which has configurable scope.<a href="#section-3.3.1-3.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.3.1-3.6">
              <p id="section-3.3.1-3.6.1">"Clear-Site-Data" <span>[<a href="#CLEAR-SITE-DATA" class="cite xref">CLEAR-SITE-DATA</a>]</span><a href="#section-3.3.1-3.6.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="authentication-headers">
<section id="section-3.3.2">
          <h4 id="name-authentication-headers">
<a href="#section-3.3.2" class="section-number selfRef">3.3.2. </a><a href="#name-authentication-headers" class="section-name selfRef">Authentication Headers</a>
          </h4>
<p id="section-3.3.2-1">Authentication to a templated TCP proxy normally uses ordinary HTTP authentication via the "401 (Unauthorized)" response code, the "WWW-Authenticate" response header field, and the "Authorization" request header field (<span>[<a href="#RFC9110" class="cite xref">RFC9110</a>], <a href="https://rfc-editor.org/rfc/rfc9110#section-11.6" class="relref">Section 11.6</a></span>).  A templated TCP proxy does not use the "407 (Proxy Authentication Required)" response code and related header fields (<span>[<a href="#RFC9110" class="cite xref">RFC9110</a>], <a href="https://rfc-editor.org/rfc/rfc9110#section-11.7" class="relref">Section 11.7</a></span>) because they do not traverse HTTP gateways (see <a href="#operational-considerations" class="auto internal xref">Section 7</a>).<a href="#section-3.3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.3.2-2">Clients <span class="bcp14">SHOULD</span> assume that all proxy resources generated by a single template share a protection space (i.e., a realm) (<span>[<a href="#RFC9110" class="cite xref">RFC9110</a>], <a href="https://rfc-editor.org/rfc/rfc9110#section-11.5" class="relref">Section 11.5</a></span>).  For many authentication schemes, this will allow the client to avoid waiting for a "401 (Unauthorized)" response before each new connection through the proxy.<a href="#section-3.3.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="closing-connections">
<section id="section-3.4">
        <h3 id="name-closing-connections">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-closing-connections" class="section-name selfRef">Closing Connections</a>
        </h3>
<p id="section-3.4-1">Connection termination is essentially symmetrical for proxies and their clients.  In this section, we use the term "endpoint" to describe an implementation of this specification in either role.<a href="#section-3.4-1" class="pilcrow">¶</a></p>
<p id="section-3.4-2">When closing connections, endpoints are subject to the following requirements:<a href="#section-3.4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.4-3.1">
            <p id="section-3.4-3.1.1">When an endpoint receives a valid TCP FIN, it <span class="bcp14">MUST</span> send a FINAL_DATA capsule.<a href="#section-3.4-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.4-3.2">
            <p id="section-3.4-3.2.1">When an endpoint receives a valid FINAL_DATA capsule, it <span class="bcp14">MUST</span> send a TCP FIN.<a href="#section-3.4-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.4-3.3">
            <p id="section-3.4-3.3.1">When a TCP connection reaches the TIME-WAIT or CLOSED state, the associated endpoint <span class="bcp14">MUST</span> close its send stream.<a href="#section-3.4-3.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.4-3.3.2.1">
                <p id="section-3.4-3.3.2.1.1">If the connection closed gracefully, the endpoint <span class="bcp14">MUST</span> close the send stream gracefully.<a href="#section-3.4-3.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-3.4-3.3.2.2">
                <p id="section-3.4-3.3.2.2.1">Otherwise, the endpoint <span class="bcp14">SHOULD</span> close the send stream abruptly, using a mechanism appropriate to the HTTP version:<a href="#section-3.4-3.3.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.4-3.3.2.2.2.1">
                    <p id="section-3.4-3.3.2.2.2.1.1">HTTP/3: RESET_STREAM with H3_CONNECT_ERROR<a href="#section-3.4-3.3.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-3.4-3.3.2.2.2.2">
                    <p id="section-3.4-3.3.2.2.2.2.1">HTTP/2: RST_STREAM with CONNECT_ERROR<a href="#section-3.4-3.3.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-3.4-3.3.2.2.2.3">
                    <p id="section-3.4-3.3.2.2.2.3.1">HTTP/1.1 over TLS: a TLS Error Alert<a href="#section-3.4-3.3.2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-3.4-3.3.2.2.2.4">
                    <p id="section-3.4-3.3.2.2.2.4.1">HTTP/1.1 (insecure): TCP RST.<a href="#section-3.4-3.3.2.2.2.4.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="normal" id="section-3.4-3.4">
            <p id="section-3.4-3.4.1">When the receive stream is closed abruptly or without a FINAL_DATA capsule received, the endpoint <span class="bcp14">SHOULD</span> send a TCP RST if the TCP subsystem permits it.<a href="#section-3.4-3.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.4-4">The mandatory behaviors above enable endpoints to detect any truncation of incoming TCP data.  The recommended behaviors propagate any TCP errors through the proxy connection.<a href="#section-3.4-4" class="pilcrow">¶</a></p>
<span id="name-simple-graceful-termination"></span><figure id="figure-3">
          <div id="section-3.4-5.1">
            <div class="alignLeft art-svg artwork" id="section-3.4-5.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="176" width="472" viewBox="0 0 472 176" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,32 L 8,64" fill="none" stroke="black"></path>
                <path d="M 24,64 L 24,160" fill="none" stroke="black"></path>
                <path d="M 72,32 L 72,64" fill="none" stroke="black"></path>
                <path d="M 112,32 L 112,64" fill="none" stroke="black"></path>
                <path d="M 128,64 L 128,160" fill="none" stroke="black"></path>
                <path d="M 216,32 L 216,64" fill="none" stroke="black"></path>
                <path d="M 256,32 L 256,64" fill="none" stroke="black"></path>
                <path d="M 344,64 L 344,160" fill="none" stroke="black"></path>
                <path d="M 360,32 L 360,64" fill="none" stroke="black"></path>
                <path d="M 400,32 L 400,64" fill="none" stroke="black"></path>
                <path d="M 448,64 L 448,160" fill="none" stroke="black"></path>
                <path d="M 464,32 L 464,64" fill="none" stroke="black"></path>
                <path d="M 8,32 L 72,32" fill="none" stroke="black"></path>
                <path d="M 112,32 L 216,32" fill="none" stroke="black"></path>
                <path d="M 256,32 L 360,32" fill="none" stroke="black"></path>
                <path d="M 400,32 L 464,32" fill="none" stroke="black"></path>
                <path d="M 8,64 L 72,64" fill="none" stroke="black"></path>
                <path d="M 112,64 L 216,64" fill="none" stroke="black"></path>
                <path d="M 256,64 L 360,64" fill="none" stroke="black"></path>
                <path d="M 400,64 L 464,64" fill="none" stroke="black"></path>
                <path d="M 24,80 L 48,80" fill="none" stroke="black"></path>
                <path d="M 96,80 L 184,80" fill="none" stroke="black"></path>
                <path d="M 280,80 L 368,80" fill="none" stroke="black"></path>
                <path d="M 416,80 L 440,80" fill="none" stroke="black"></path>
                <path d="M 24,96 L 56,96" fill="none" stroke="black"></path>
                <path d="M 88,96 L 176,96" fill="none" stroke="black"></path>
                <path d="M 296,96 L 376,96" fill="none" stroke="black"></path>
                <path d="M 408,96 L 440,96" fill="none" stroke="black"></path>
                <path d="M 32,112 L 56,112" fill="none" stroke="black"></path>
                <path d="M 88,112 L 176,112" fill="none" stroke="black"></path>
                <path d="M 296,112 L 376,112" fill="none" stroke="black"></path>
                <path d="M 408,112 L 448,112" fill="none" stroke="black"></path>
                <path d="M 136,128 L 168,128" fill="none" stroke="black"></path>
                <path d="M 304,128 L 344,128" fill="none" stroke="black"></path>
                <path d="M 24,144 L 48,144" fill="none" stroke="black"></path>
                <path d="M 104,144 L 168,144" fill="none" stroke="black"></path>
                <path d="M 304,144 L 336,144" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="448,96 436,90.4 436,101.6" fill="black" transform="rotate(0,440,96)"></polygon>
                <polygon class="arrowhead" points="448,80 436,74.4 436,85.6" fill="black" transform="rotate(0,440,80)"></polygon>
                <polygon class="arrowhead" points="360,112 348,106.4 348,117.6" fill="black" transform="rotate(180,352,112)"></polygon>
                <polygon class="arrowhead" points="344,144 332,138.4 332,149.6" fill="black" transform="rotate(0,336,144)"></polygon>
                <polygon class="arrowhead" points="344,96 332,90.4 332,101.6" fill="black" transform="rotate(0,336,96)"></polygon>
                <polygon class="arrowhead" points="344,80 332,74.4 332,85.6" fill="black" transform="rotate(0,336,80)"></polygon>
                <polygon class="arrowhead" points="144,128 132,122.4 132,133.6" fill="black" transform="rotate(180,136,128)"></polygon>
                <polygon class="arrowhead" points="144,112 132,106.4 132,117.6" fill="black" transform="rotate(180,136,112)"></polygon>
                <polygon class="arrowhead" points="128,144 116,138.4 116,149.6" fill="black" transform="rotate(0,120,144)"></polygon>
                <polygon class="arrowhead" points="128,96 116,90.4 116,101.6" fill="black" transform="rotate(0,120,96)"></polygon>
                <polygon class="arrowhead" points="128,80 116,74.4 116,85.6" fill="black" transform="rotate(0,120,80)"></polygon>
                <polygon class="arrowhead" points="40,112 28,106.4 28,117.6" fill="black" transform="rotate(180,32,112)"></polygon>
                <g class="text">
                  <text x="32" y="52">TCP</text>
                  <text x="56" y="52">A</text>
                  <text x="156" y="52">Endpoint</text>
                  <text x="200" y="52">A</text>
                  <text x="300" y="52">Endpoint</text>
                  <text x="344" y="52">B</text>
                  <text x="424" y="52">TCP</text>
                  <text x="448" y="52">B</text>
                  <text x="72" y="84">"abc"</text>
                  <text x="232" y="84">DATA{"abc"}</text>
                  <text x="392" y="84">"abc"</text>
                  <text x="72" y="100">FIN</text>
                  <text x="236" y="100">FINAL_DATA{""}</text>
                  <text x="392" y="100">FIN</text>
                  <text x="72" y="116">FIN</text>
                  <text x="236" y="116">FINAL_DATA{""}</text>
                  <text x="392" y="116">FIN</text>
                  <text x="236" y="132">QUIC.STREAM{FIN}</text>
                  <text x="76" y="148">FINACK</text>
                  <text x="236" y="148">QUIC.STREAM{FIN}</text>
                </g>
              </svg><a href="#section-3.4-5.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-simple-graceful-termination" class="selfRef">Simple graceful termination example (HTTP/3)</a>
          </figcaption></figure>
<span id="name-simple-tcp-rst-termination-"></span><figure id="figure-4">
          <div id="section-3.4-6.1">
            <div class="alignLeft art-svg artwork" id="section-3.4-6.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="112" width="472" viewBox="0 0 472 112" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,32 L 8,64" fill="none" stroke="black"></path>
                <path d="M 24,64 L 24,96" fill="none" stroke="black"></path>
                <path d="M 72,32 L 72,64" fill="none" stroke="black"></path>
                <path d="M 112,32 L 112,64" fill="none" stroke="black"></path>
                <path d="M 128,64 L 128,96" fill="none" stroke="black"></path>
                <path d="M 216,32 L 216,64" fill="none" stroke="black"></path>
                <path d="M 256,32 L 256,64" fill="none" stroke="black"></path>
                <path d="M 344,64 L 344,96" fill="none" stroke="black"></path>
                <path d="M 360,32 L 360,64" fill="none" stroke="black"></path>
                <path d="M 400,32 L 400,64" fill="none" stroke="black"></path>
                <path d="M 448,64 L 448,96" fill="none" stroke="black"></path>
                <path d="M 464,32 L 464,64" fill="none" stroke="black"></path>
                <path d="M 8,32 L 72,32" fill="none" stroke="black"></path>
                <path d="M 112,32 L 216,32" fill="none" stroke="black"></path>
                <path d="M 256,32 L 360,32" fill="none" stroke="black"></path>
                <path d="M 400,32 L 464,32" fill="none" stroke="black"></path>
                <path d="M 8,64 L 72,64" fill="none" stroke="black"></path>
                <path d="M 112,64 L 216,64" fill="none" stroke="black"></path>
                <path d="M 256,64 L 360,64" fill="none" stroke="black"></path>
                <path d="M 400,64 L 464,64" fill="none" stroke="black"></path>
                <path d="M 24,80 L 56,80" fill="none" stroke="black"></path>
                <path d="M 88,80 L 152,80" fill="none" stroke="black"></path>
                <path d="M 312,80 L 376,80" fill="none" stroke="black"></path>
                <path d="M 408,80 L 440,80" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="448,80 436,74.4 436,85.6" fill="black" transform="rotate(0,440,80)"></polygon>
                <polygon class="arrowhead" points="344,80 332,74.4 332,85.6" fill="black" transform="rotate(0,336,80)"></polygon>
                <polygon class="arrowhead" points="128,80 116,74.4 116,85.6" fill="black" transform="rotate(0,120,80)"></polygon>
                <g class="text">
                  <text x="32" y="52">TCP</text>
                  <text x="56" y="52">A</text>
                  <text x="156" y="52">Endpoint</text>
                  <text x="200" y="52">A</text>
                  <text x="300" y="52">Endpoint</text>
                  <text x="344" y="52">B</text>
                  <text x="424" y="52">TCP</text>
                  <text x="448" y="52">B</text>
                  <text x="72" y="84">RST</text>
                  <text x="232" y="84">RST_STREAM{CON_ERR}</text>
                  <text x="392" y="84">RST</text>
                </g>
              </svg><a href="#section-3.4-6.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-simple-tcp-rst-termination-" class="selfRef">Simple TCP RST termination example (HTTP/2)</a>
          </figcaption></figure>
<span id="name-timeout-example-http-11"></span><figure id="figure-5">
          <div id="section-3.4-7.1">
            <div class="alignLeft art-svg artwork" id="section-3.4-7.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="144" width="472" viewBox="0 0 472 144" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,32 L 8,64" fill="none" stroke="black"></path>
                <path d="M 24,64 L 24,128" fill="none" stroke="black"></path>
                <path d="M 72,32 L 72,64" fill="none" stroke="black"></path>
                <path d="M 112,32 L 112,64" fill="none" stroke="black"></path>
                <path d="M 128,64 L 128,128" fill="none" stroke="black"></path>
                <path d="M 216,32 L 216,64" fill="none" stroke="black"></path>
                <path d="M 256,32 L 256,64" fill="none" stroke="black"></path>
                <path d="M 344,64 L 344,128" fill="none" stroke="black"></path>
                <path d="M 360,32 L 360,64" fill="none" stroke="black"></path>
                <path d="M 400,32 L 400,64" fill="none" stroke="black"></path>
                <path d="M 448,64 L 448,128" fill="none" stroke="black"></path>
                <path d="M 464,32 L 464,64" fill="none" stroke="black"></path>
                <path d="M 8,32 L 72,32" fill="none" stroke="black"></path>
                <path d="M 112,32 L 216,32" fill="none" stroke="black"></path>
                <path d="M 256,32 L 360,32" fill="none" stroke="black"></path>
                <path d="M 400,32 L 464,32" fill="none" stroke="black"></path>
                <path d="M 8,64 L 72,64" fill="none" stroke="black"></path>
                <path d="M 112,64 L 216,64" fill="none" stroke="black"></path>
                <path d="M 256,64 L 360,64" fill="none" stroke="black"></path>
                <path d="M 400,64 L 464,64" fill="none" stroke="black"></path>
                <path d="M 24,80 L 48,80" fill="none" stroke="black"></path>
                <path d="M 96,80 L 184,80" fill="none" stroke="black"></path>
                <path d="M 280,80 L 368,80" fill="none" stroke="black"></path>
                <path d="M 416,80 L 440,80" fill="none" stroke="black"></path>
                <path d="M 128,112 L 192,112" fill="none" stroke="black"></path>
                <path d="M 272,112 L 376,112" fill="none" stroke="black"></path>
                <path d="M 408,112 L 440,112" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="448,112 436,106.4 436,117.6" fill="black" transform="rotate(0,440,112)"></polygon>
                <polygon class="arrowhead" points="448,80 436,74.4 436,85.6" fill="black" transform="rotate(0,440,80)"></polygon>
                <polygon class="arrowhead" points="344,112 332,106.4 332,117.6" fill="black" transform="rotate(0,336,112)"></polygon>
                <polygon class="arrowhead" points="344,80 332,74.4 332,85.6" fill="black" transform="rotate(0,336,80)"></polygon>
                <polygon class="arrowhead" points="128,80 116,74.4 116,85.6" fill="black" transform="rotate(0,120,80)"></polygon>
                <g class="text">
                  <text x="32" y="52">TCP</text>
                  <text x="56" y="52">A</text>
                  <text x="156" y="52">Endpoint</text>
                  <text x="200" y="52">A</text>
                  <text x="300" y="52">Endpoint</text>
                  <text x="344" y="52">B</text>
                  <text x="424" y="52">TCP</text>
                  <text x="448" y="52">B</text>
                  <text x="72" y="84">"abc"</text>
                  <text x="232" y="84">DATA{"abc"}</text>
                  <text x="392" y="84">"abc"</text>
                  <text x="164" y="100">(...</text>
                  <text x="216" y="100">timeout</text>
                  <text x="256" y="100">@</text>
                  <text x="272" y="100">A</text>
                  <text x="300" y="100">...)</text>
                  <text x="208" y="116">TLS</text>
                  <text x="248" y="116">Alert</text>
                  <text x="392" y="116">RST</text>
                </g>
              </svg><a href="#section-3.4-7.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-timeout-example-http-11" class="selfRef">Timeout example (HTTP/1.1)</a>
          </figcaption></figure>
<span id="name-rst-after-fin-example-http-"></span><figure id="figure-6">
          <div id="section-3.4-8.1">
            <div class="alignLeft art-svg artwork" id="section-3.4-8.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="192" width="472" viewBox="0 0 472 192" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,32 L 8,64" fill="none" stroke="black"></path>
                <path d="M 24,64 L 24,176" fill="none" stroke="black"></path>
                <path d="M 72,32 L 72,64" fill="none" stroke="black"></path>
                <path d="M 112,32 L 112,64" fill="none" stroke="black"></path>
                <path d="M 128,64 L 128,176" fill="none" stroke="black"></path>
                <path d="M 216,32 L 216,64" fill="none" stroke="black"></path>
                <path d="M 256,32 L 256,64" fill="none" stroke="black"></path>
                <path d="M 344,64 L 344,176" fill="none" stroke="black"></path>
                <path d="M 360,32 L 360,64" fill="none" stroke="black"></path>
                <path d="M 400,32 L 400,64" fill="none" stroke="black"></path>
                <path d="M 448,64 L 448,176" fill="none" stroke="black"></path>
                <path d="M 464,32 L 464,64" fill="none" stroke="black"></path>
                <path d="M 8,32 L 72,32" fill="none" stroke="black"></path>
                <path d="M 112,32 L 216,32" fill="none" stroke="black"></path>
                <path d="M 256,32 L 360,32" fill="none" stroke="black"></path>
                <path d="M 400,32 L 464,32" fill="none" stroke="black"></path>
                <path d="M 8,64 L 72,64" fill="none" stroke="black"></path>
                <path d="M 112,64 L 216,64" fill="none" stroke="black"></path>
                <path d="M 256,64 L 360,64" fill="none" stroke="black"></path>
                <path d="M 400,64 L 464,64" fill="none" stroke="black"></path>
                <path d="M 24,80 L 64,80" fill="none" stroke="black"></path>
                <path d="M 96,80 L 184,80" fill="none" stroke="black"></path>
                <path d="M 304,80 L 384,80" fill="none" stroke="black"></path>
                <path d="M 416,80 L 440,80" fill="none" stroke="black"></path>
                <path d="M 32,128 L 56,128" fill="none" stroke="black"></path>
                <path d="M 104,128 L 168,128" fill="none" stroke="black"></path>
                <path d="M 312,128 L 376,128" fill="none" stroke="black"></path>
                <path d="M 424,128 L 448,128" fill="none" stroke="black"></path>
                <path d="M 136,144 L 168,144" fill="none" stroke="black"></path>
                <path d="M 304,144 L 344,144" fill="none" stroke="black"></path>
                <path d="M 24,160 L 64,160" fill="none" stroke="black"></path>
                <path d="M 96,160 L 168,160" fill="none" stroke="black"></path>
                <path d="M 304,160 L 384,160" fill="none" stroke="black"></path>
                <path d="M 416,160 L 440,160" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="448,160 436,154.4 436,165.6" fill="black" transform="rotate(0,440,160)"></polygon>
                <polygon class="arrowhead" points="448,80 436,74.4 436,85.6" fill="black" transform="rotate(0,440,80)"></polygon>
                <polygon class="arrowhead" points="360,128 348,122.4 348,133.6" fill="black" transform="rotate(180,352,128)"></polygon>
                <polygon class="arrowhead" points="344,160 332,154.4 332,165.6" fill="black" transform="rotate(0,336,160)"></polygon>
                <polygon class="arrowhead" points="344,80 332,74.4 332,85.6" fill="black" transform="rotate(0,336,80)"></polygon>
                <polygon class="arrowhead" points="144,144 132,138.4 132,149.6" fill="black" transform="rotate(180,136,144)"></polygon>
                <polygon class="arrowhead" points="144,128 132,122.4 132,133.6" fill="black" transform="rotate(180,136,128)"></polygon>
                <polygon class="arrowhead" points="128,160 116,154.4 116,165.6" fill="black" transform="rotate(0,120,160)"></polygon>
                <polygon class="arrowhead" points="128,80 116,74.4 116,85.6" fill="black" transform="rotate(0,120,80)"></polygon>
                <polygon class="arrowhead" points="40,128 28,122.4 28,133.6" fill="black" transform="rotate(180,32,128)"></polygon>
                <g class="text">
                  <text x="32" y="52">TCP</text>
                  <text x="56" y="52">A</text>
                  <text x="156" y="52">Endpoint</text>
                  <text x="200" y="52">A</text>
                  <text x="300" y="52">Endpoint</text>
                  <text x="344" y="52">B</text>
                  <text x="424" y="52">TCP</text>
                  <text x="448" y="52">B</text>
                  <text x="80" y="84">FIN</text>
                  <text x="244" y="84">FINAL_DATA{""}</text>
                  <text x="400" y="84">FIN</text>
                  <text x="80" y="116">(FIN)</text>
                  <text x="400" y="116">(FIN)</text>
                  <text x="80" y="132">"abc"</text>
                  <text x="240" y="132">FINAL_DATA{"abc"}</text>
                  <text x="400" y="132">"abc"</text>
                  <text x="236" y="148">QUIC.STREAM{FIN}</text>
                  <text x="80" y="164">RST</text>
                  <text x="236" y="164">H3_CONNECT_ERROR</text>
                  <text x="400" y="164">RST</text>
                </g>
              </svg><a href="#section-3.4-8.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-rst-after-fin-example-http-" class="selfRef">RST after FIN example (HTTP/3)</a>
          </figcaption></figure>
</section>
</div>
</section>
</div>
<div id="additional-connection-setup-behaviors">
<section id="section-4">
      <h2 id="name-additional-connection-setup">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-additional-connection-setup" class="section-name selfRef">Additional Connection Setup Behaviors</a>
      </h2>
<p id="section-4-1">This section discusses some behaviors that are permitted or recommended in order to enhance the performance or functionality of connection setup.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="latency-optimizations">
<section id="section-4.1">
        <h3 id="name-latency-optimizations">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-latency-optimizations" class="section-name selfRef">Latency optimizations</a>
        </h3>
<p id="section-4.1-1">When using this specification in HTTP/2 or HTTP/3, clients <span class="bcp14">MAY</span> start sending TCP stream content optimistically, subject to flow control limits (<span><a href="https://rfc-editor.org/rfc/rfc9113#section-5.2" class="relref">Section 5.2</a> of [<a href="#RFC9113" class="cite xref">RFC9113</a>]</span> or <span><a href="https://rfc-editor.org/rfc/rfc9000#section-4.1" class="relref">Section 4.1</a> of [<a href="#RFC9000" class="cite xref">RFC9000</a>]</span>).  Proxies <span class="bcp14">MUST</span> buffer this "optimistic" content until the TCP stream becomes writable, and discard it if the TCP connection fails.  (Clients <span class="bcp14">MUST NOT</span> use "optimistic" behavior in HTTP/1.1, as this would interfere with reuse of the connection after an error response such as "401 (Unauthorized)".)<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">Servers that host a proxy under this specification <span class="bcp14">MAY</span> offer support for TLS early data in accordance with <span>[<a href="#RFC8470" class="cite xref">RFC8470</a>]</span>.  Clients <span class="bcp14">MAY</span> send "connect-tcp" requests in early data, and <span class="bcp14">MAY</span> include "optimistic" TCP content in early data (in HTTP/2 and HTTP/3).  At the TLS layer, proxies <span class="bcp14">MAY</span> ignore, reject, or accept the <code>early_data</code> extension (<span>[<a href="#RFC8446" class="cite xref">RFC8446</a>], <a href="https://rfc-editor.org/rfc/rfc8446#section-4.2.10" class="relref">Section 4.2.10</a></span>).  At the HTTP layer, proxies <span class="bcp14">MAY</span> process the request immediately, return a "425 (Too Early)" response (<span>[<a href="#RFC8470" class="cite xref">RFC8470</a>], <a href="https://rfc-editor.org/rfc/rfc8470#section-5.2" class="relref">Section 5.2</a></span>), or delay some or all processing of the request until the handshake completes.  For example, a proxy with limited anti-replay defenses might choose to perform DNS resolution of the <code>target_host</code> when a request arrives in early data, but delay the TCP connection until the TLS handshake completes.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conveying-metadata">
<section id="section-4.2">
        <h3 id="name-conveying-metadata">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-conveying-metadata" class="section-name selfRef">Conveying metadata</a>
        </h3>
<p id="section-4.2-1">This specification supports the "Expect: 100-continue" request header (<span>[<a href="#RFC9110" class="cite xref">RFC9110</a>], <a href="https://rfc-editor.org/rfc/rfc9110#section-10.1.1" class="relref">Section 10.1.1</a></span>) in any HTTP version.  The "100 (Continue)" status code confirms receipt of a request at the proxy without waiting for the proxy-destination TCP handshake to succeed or fail.  This might be particularly helpful when the destination host is not responding, as TCP handshakes can hang for several minutes before failing.  Clients <span class="bcp14">MAY</span> send "Expect: 100-continue", and proxies <span class="bcp14">MUST</span> respect it by returning "100 (Continue)" if the request is not immediately rejected.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">Proxies implementing this specification <span class="bcp14">SHOULD</span> include a "Proxy-Status" response header <span>[<a href="#RFC9209" class="cite xref">RFC9209</a>]</span> in any success or failure response (i.e., status codes 101, 2XX, 4XX, or 5XX) to support advanced client behaviors and diagnostics.  In HTTP/2 or HTTP/3, proxies <span class="bcp14">MAY</span> additionally send a "Proxy-Status" trailer in the event of an unclean shutdown.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="applicability">
<section id="section-5">
      <h2 id="name-applicability">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-applicability" class="section-name selfRef">Applicability</a>
      </h2>
<div id="servers">
<section id="section-5.1">
        <h3 id="name-servers">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-servers" class="section-name selfRef">Servers</a>
        </h3>
<p id="section-5.1-1">For server operators, template-driven TCP proxies are particularly valuable in situations where virtual-hosting is needed, or where multiple proxies must share an origin.  For example, the proxy might benefit from sharing an HTTP gateway that provides DDoS defense, performs request sanitization, or enforces user authorization.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">The URI template can also be structured to generate high-entropy Capability URLs <span>[<a href="#CAPABILITY" class="cite xref">CAPABILITY</a>]</span>, so that only authorized users can discover the proxy service.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="clients">
<section id="section-5.2">
        <h3 id="name-clients">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-clients" class="section-name selfRef">Clients</a>
        </h3>
<p id="section-5.2-1">Clients that support both classic HTTP CONNECT proxies and template-driven TCP proxies <span class="bcp14">MAY</span> accept both types via a single configuration string.  If the configuration string can be parsed as a URI Template containing the required variables, it is a template-driven TCP proxy.  Otherwise, it is presumed to represent a classic HTTP CONNECT proxy.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">In some cases, it is valuable to allow "connect-tcp" clients to reach "connect-tcp"-only proxies when using a legacy configuration method that cannot convey a URI Template.  To support this arrangement, clients <span class="bcp14">SHOULD</span> treat certain errors during classic HTTP CONNECT as indications that the proxy might only support "connect-tcp":<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-3.1">
            <p id="section-5.2-3.1.1">In HTTP/1.1: the response status code is "426 (Upgrade Required)", with an "Upgrade: connect-tcp" response header.<a href="#section-5.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-3.2">
            <p id="section-5.2-3.2.1">In any HTTP version: the response status code is "501 (Not Implemented)".<a href="#section-5.2-3.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-3.2.2.1">
                <p id="section-5.2-3.2.2.1.1">Requires SETTINGS_ENABLE_CONNECT_PROTOCOL to have been negotiated in HTTP/2 or HTTP/3.<a href="#section-5.2-3.2.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-5.2-4">If the client infers that classic HTTP CONNECT is not supported, it <span class="bcp14">SHOULD</span> retry the request using the registered default template for "connect-tcp":<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<span id="name-registered-default-template"></span><figure id="figure-7">
          <div class="alignLeft art-text artwork" id="section-5.2-5.1">
<pre>
https://$PROXY_HOST:$PROXY_PORT/.well-known/masque
                 /tcp/{target_host}/{target_port}/
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-registered-default-template" class="selfRef">Registered default template</a>
          </figcaption></figure>
<p id="section-5.2-6">If this request succeeds, the client <span class="bcp14">SHOULD</span> record a preference for "connect-tcp" to avoid further retry delays.<a href="#section-5.2-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-6">
      <h2 id="name-security-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-6-1">Template-driven TCP proxying is largely subject to the same security risks as classic HTTP CONNECT.  For example, any restrictions on authorized use of the proxy (see <span>[<a href="#RFC9110" class="cite xref">RFC9110</a>], <a href="https://rfc-editor.org/rfc/rfc9110#section-9.3.6" class="relref">Section 9.3.6</a></span>) apply equally to both.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">A small additional risk is posed by the use of a URI Template parser on the client side.  The template input string could be crafted to exploit any vulnerabilities in the parser implementation.  Client implementers should apply their usual precautions for code that processes untrusted inputs.<a href="#section-6-2" class="pilcrow">¶</a></p>
<div id="resource-exhaustion-attacks">
<section id="section-6.1">
        <h3 id="name-resource-exhaustion-attacks">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-resource-exhaustion-attacks" class="section-name selfRef">Resource Exhaustion attacks</a>
        </h3>
<p id="section-6.1-1">A malicious client can achieve cause highly asymmetric resource usage at the proxy by colluding with a destination server and violating the ordinary rules of TCP or HTTP.  Some example attacks, and mitigations that proxies can apply:<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-2.1">
            <p id="section-6.1-2.1.1"><strong>Connection Pileup</strong>: A malicious client can attempt to open a large number of proxy&lt;-&gt;destination connections to exhaust the proxy's memory, port, or file descriptor limits. When using HTTP/2 or HTTP/3, each incremental TCP connection imposes a much higher cost on the proxy than on the attacker.<a href="#section-6.1-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-2.1.2.1">
                <p id="section-6.1-2.1.2.1.1">Mitigation: Limit the number of concurrent connections per client.<a href="#section-6.1-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-6.1-2.2">
            <p id="section-6.1-2.2.1"><strong>Window Bloat</strong>: An attacker can grow the receive window size by simulating a "long, fat network" <span>[<a href="#RFC7323" class="cite xref">RFC7323</a>]</span>, then fill the window (from the sender) and stop acknowledging it (at the receiver).  This leaves the proxy buffering up to 1 GiB of TCP data until some timeout, while the attacker does not have to retain a large buffer.<a href="#section-6.1-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-2.2.2.1">
                <p id="section-6.1-2.2.2.1.1">Mitigation: Limit the maximum receive window for TCP and HTTP connections, and the size of userspace buffers used for proxying.  Alternatively, monitor the connections' send queues and limit the total buffered data per client.<a href="#section-6.1-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-6.1-2.3">
            <p id="section-6.1-2.3.1"><strong>WAIT Abuse</strong>: An attacker can force the proxy into a TIME-WAIT, CLOSE-WAIT, or FIN-WAIT state until the timer expires, tying up a proxy&lt;-&gt;destination 4-tuple for up to four minutes after the client's connection is closed.<a href="#section-6.1-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-2.3.2.1">
                <p id="section-6.1-2.3.2.1.1">Mitigation: Limit the number of connections for each client to each destination, even if those connections are in a waiting state and the corresponding CONNECT stream is closed.  Alternatively, allocate a large range of IP addresses for TCP connections (especially in IPv6).<a href="#section-6.1-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="operational-considerations">
<section id="section-7">
      <h2 id="name-operational-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-operational-considerations" class="section-name selfRef">Operational Considerations</a>
      </h2>
<div id="avoiding-http11">
<section id="section-7.1">
        <h3 id="name-avoiding-http-11">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-avoiding-http-11" class="section-name selfRef">Avoiding HTTP/1.1</a>
        </h3>
<p id="section-7.1-1">While this specification is fully functional under HTTP/1.1, performance-sensitive deployments <span class="bcp14">SHOULD</span> use HTTP/2 or HTTP/3 instead.  When using HTTP/1.1:<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1-2.1">
            <p id="section-7.1-2.1.1">Each CONNECT request requires a new TCP and TLS connection, imposing a higher cost in setup latency, congestion control convergence, CPU time, and data transfer.<a href="#section-7.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.1-2.2">
            <p id="section-7.1-2.2.1">It may be difficult to implement the recommended unclean shutdown signals (<a href="#closing-connections" class="auto internal xref">Section 3.4</a>), as many TLS libraries do not support injecting TLS Alerts.<a href="#section-7.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.1-2.3">
            <p id="section-7.1-2.3.1">The number of active connections through each client may be limited by the number of available TCP client ports, especially if:<a href="#section-7.1-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1-2.3.2.1">
                <p id="section-7.1-2.3.2.1.1">The client only has one IP address that can be used to reach the proxy.<a href="#section-7.1-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-7.1-2.3.2.2">
                <p id="section-7.1-2.3.2.2.1">The client is shared between many parties, such as when acting as a gateway or concentrator.<a href="#section-7.1-2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-7.1-2.3.2.3">
                <p id="section-7.1-2.3.2.3.1">The proxied connections are often closed by the destination. This causes the client to initiate closure of the client&lt;-&gt;proxy connection, leaving the client in a TIME-WAIT state for up to four minutes.<a href="#section-7.1-2.3.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
</section>
</div>
<div id="gateway-compatibility">
<section id="section-7.2">
        <h3 id="name-gateway-compatibility">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-gateway-compatibility" class="section-name selfRef">Gateway Compatibility</a>
        </h3>
<p id="section-7.2-1">Templated TCP proxies can make use of standard HTTP gateways and path-routing to ease implementation and allow use of shared infrastructure.  However, current gateways might need modifications to support TCP proxy services.  To be compatible, a gateway must:<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2-2.1">
            <p id="section-7.2-2.1.1">support Extended CONNECT (if acting as an HTTP/2 or HTTP/3 server).<a href="#section-7.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.2-2.2">
            <p id="section-7.2-2.2.1">support HTTP/1.1 Upgrade to "connect-tcp" (if acting as an HTTP/1.1 server)<a href="#section-7.2-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2-2.2.2.1">
                <p id="section-7.2-2.2.2.1.1">only after forwarding the upgrade request to the origin and observing a success response.<a href="#section-7.2-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-7.2-2.3">
            <p id="section-7.2-2.3.1">forward the "connect-tcp" protocol to the origin.<a href="#section-7.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.2-2.4">
            <p id="section-7.2-2.4.1">convert "connect-tcp" requests between all supported HTTP server and client versions.<a href="#section-7.2-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.2-2.5">
            <p id="section-7.2-2.5.1">allow any "Proxy-Status" headers to traverse the gateway.<a href="#section-7.2-2.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<div id="new-upgrade-token">
<section id="section-8.1">
        <h3 id="name-new-upgrade-token">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-new-upgrade-token" class="section-name selfRef">New Upgrade Token</a>
        </h3>
<p id="section-8.1-1">IF APPROVED, IANA is requested to add the following entry to the HTTP Upgrade Token Registry:<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
          <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Value</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">"connect-tcp"</td>
              <td class="text-left" rowspan="1" colspan="1">Proxying of TCP payloads</td>
              <td class="text-left" rowspan="1" colspan="1">(This document)</td>
            </tr>
          </tbody>
        </table>
<p id="section-8.1-3">For interoperability testing of this draft version, implementations <span class="bcp14">SHALL</span> use the value "connect-tcp-07".<a href="#section-8.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-template">
<section id="section-8.2">
        <h3 id="name-new-masque-default-template">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-new-masque-default-template" class="section-name selfRef">New MASQUE Default Template</a>
        </h3>
<p id="section-8.2-1">IF APPROVED, IANA is requested to add the following entry to the "MASQUE URI Suffixes" registry:<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<table class="center" id="table-2">
          <caption><a href="#table-2" class="selfRef">Table 2</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Path Segment</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">tcp</td>
              <td class="text-left" rowspan="1" colspan="1">TCP Proxying</td>
              <td class="text-left" rowspan="1" colspan="1">(This document)</td>
            </tr>
          </tbody>
        </table>
</section>
</div>
<div id="data-capsule">
<section id="section-8.3">
        <h3 id="name-new-capsule-type">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-new-capsule-type" class="section-name selfRef">New Capsule Type</a>
        </h3>
<p id="section-8.3-1">IF APPROVED, IANA is requested to add the following entry to the "HTTP Capsule Types" registry:<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<table class="center" id="table-3">
          <caption><a href="#table-3" class="selfRef">Table 3</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Value</th>
              <th class="text-left" rowspan="1" colspan="1">Capsule Type</th>
              <th class="text-left" rowspan="1" colspan="1">Status</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
              <th class="text-left" rowspan="1" colspan="1">Change Controller</th>
              <th class="text-left" rowspan="1" colspan="1">Contact</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">(TBD)</td>
              <td class="text-left" rowspan="1" colspan="1">DATA</td>
              <td class="text-left" rowspan="1" colspan="1">permanent</td>
              <td class="text-left" rowspan="1" colspan="1">(This document), <a href="#specification" class="auto internal xref">Section 3</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">IETF</td>
              <td class="text-left" rowspan="1" colspan="1">HTTPBIS</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">(TBD)</td>
              <td class="text-left" rowspan="1" colspan="1">FINAL_DATA</td>
              <td class="text-left" rowspan="1" colspan="1">permanent</td>
              <td class="text-left" rowspan="1" colspan="1">(This document), <a href="#specification" class="auto internal xref">Section 3</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">IETF</td>
              <td class="text-left" rowspan="1" colspan="1">HTTPBIS</td>
            </tr>
          </tbody>
        </table>
<p id="section-8.3-3">For this draft version of the protocol, the Capsule Type values <code>0x2028d7f0</code> and <code>0x2028d7f1</code> shall be used provisionally for testing, under the names "DATA-08" and "FINAL_DATA-08".<a href="#section-8.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6570">[RFC6570]</dt>
        <dd>
<span class="refAuthor">Gregorio, J.</span>, <span class="refAuthor">Fielding, R.</span>, <span class="refAuthor">Hadley, M.</span>, <span class="refAuthor">Nottingham, M.</span>, and <span class="refAuthor">D. Orchard</span>, <span class="refTitle">"URI Template"</span>, <span class="seriesInfo">RFC 6570</span>, <span class="seriesInfo">DOI 10.17487/RFC6570</span>, <time datetime="2012-03" class="refDate">March 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6570">https://www.rfc-editor.org/rfc/rfc6570</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8441">[RFC8441]</dt>
        <dd>
<span class="refAuthor">McManus, P.</span>, <span class="refTitle">"Bootstrapping WebSockets with HTTP/2"</span>, <span class="seriesInfo">RFC 8441</span>, <span class="seriesInfo">DOI 10.17487/RFC8441</span>, <time datetime="2018-09" class="refDate">September 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8441">https://www.rfc-editor.org/rfc/rfc8441</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8470">[RFC8470]</dt>
        <dd>
<span class="refAuthor">Thomson, M.</span>, <span class="refAuthor">Nottingham, M.</span>, and <span class="refAuthor">W. Tarreau</span>, <span class="refTitle">"Using Early Data in HTTP"</span>, <span class="seriesInfo">RFC 8470</span>, <span class="seriesInfo">DOI 10.17487/RFC8470</span>, <time datetime="2018-09" class="refDate">September 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8470">https://www.rfc-editor.org/rfc/rfc8470</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9000">[RFC9000]</dt>
        <dd>
<span class="refAuthor">Iyengar, J., Ed.</span> and <span class="refAuthor">M. Thomson, Ed.</span>, <span class="refTitle">"QUIC: A UDP-Based Multiplexed and Secure Transport"</span>, <span class="seriesInfo">RFC 9000</span>, <span class="seriesInfo">DOI 10.17487/RFC9000</span>, <time datetime="2021-05" class="refDate">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9000">https://www.rfc-editor.org/rfc/rfc9000</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9110">[RFC9110]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP Semantics"</span>, <span class="seriesInfo">STD 97</span>, <span class="seriesInfo">RFC 9110</span>, <span class="seriesInfo">DOI 10.17487/RFC9110</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9110">https://www.rfc-editor.org/rfc/rfc9110</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9113">[RFC9113]</dt>
        <dd>
<span class="refAuthor">Thomson, M., Ed.</span> and <span class="refAuthor">C. Benfield, Ed.</span>, <span class="refTitle">"HTTP/2"</span>, <span class="seriesInfo">RFC 9113</span>, <span class="seriesInfo">DOI 10.17487/RFC9113</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9113">https://www.rfc-editor.org/rfc/rfc9113</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9114">[RFC9114]</dt>
        <dd>
<span class="refAuthor">Bishop, M., Ed.</span>, <span class="refTitle">"HTTP/3"</span>, <span class="seriesInfo">RFC 9114</span>, <span class="seriesInfo">DOI 10.17487/RFC9114</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9114">https://www.rfc-editor.org/rfc/rfc9114</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9209">[RFC9209]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span> and <span class="refAuthor">P. Sikora</span>, <span class="refTitle">"The Proxy-Status HTTP Response Header Field"</span>, <span class="seriesInfo">RFC 9209</span>, <span class="seriesInfo">DOI 10.17487/RFC9209</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9209">https://www.rfc-editor.org/rfc/rfc9209</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9220">[RFC9220]</dt>
        <dd>
<span class="refAuthor">Hamilton, R.</span>, <span class="refTitle">"Bootstrapping WebSockets with HTTP/3"</span>, <span class="seriesInfo">RFC 9220</span>, <span class="seriesInfo">DOI 10.17487/RFC9220</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9220">https://www.rfc-editor.org/rfc/rfc9220</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9298">[RFC9298]</dt>
      <dd>
<span class="refAuthor">Schinazi, D.</span>, <span class="refTitle">"Proxying UDP in HTTP"</span>, <span class="seriesInfo">RFC 9298</span>, <span class="seriesInfo">DOI 10.17487/RFC9298</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9298">https://www.rfc-editor.org/rfc/rfc9298</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="CAPABILITY">[CAPABILITY]</dt>
        <dd>
<span class="refTitle">"Good Practices for Capability URLs"</span>, <time datetime="2014-02" class="refDate">February 2014</time>, <span>&lt;<a href="https://www.w3.org/TR/capability-urls/">https://www.w3.org/TR/capability-urls/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CLEAR-SITE-DATA">[CLEAR-SITE-DATA]</dt>
        <dd>
<span class="refTitle">"Clear Site Data"</span>, <time datetime="2017-11" class="refDate">November 2017</time>, <span>&lt;<a href="https://www.w3.org/TR/clear-site-data/">https://www.w3.org/TR/clear-site-data/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CONNECT-IP">[CONNECT-IP]</dt>
        <dd>
<span class="refAuthor">Pauly, T., Ed.</span>, <span class="refAuthor">Schinazi, D.</span>, <span class="refAuthor">Chernyakhovsky, A.</span>, <span class="refAuthor">Kühlewind, M.</span>, and <span class="refAuthor">M. Westerlund</span>, <span class="refTitle">"Proxying IP in HTTP"</span>, <span class="seriesInfo">RFC 9484</span>, <span class="seriesInfo">DOI 10.17487/RFC9484</span>, <time datetime="2023-10" class="refDate">October 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9484">https://www.rfc-editor.org/rfc/rfc9484</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CONNECT-UDP">[CONNECT-UDP]</dt>
        <dd>
<span class="refAuthor">Schinazi, D.</span>, <span class="refTitle">"Proxying UDP in HTTP"</span>, <span class="seriesInfo">RFC 9298</span>, <span class="seriesInfo">DOI 10.17487/RFC9298</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9298">https://www.rfc-editor.org/rfc/rfc9298</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.schinazi-httpbis-wrap-up">[I-D.schinazi-httpbis-wrap-up]</dt>
        <dd>
<span class="refAuthor">Schinazi, D.</span> and <span class="refAuthor">L. Pardue</span>, <span class="refTitle">"The HTTP Wrap Up Capsule"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-schinazi-httpbis-wrap-up-01</span>, <time datetime="2024-10-16" class="refDate">16 October 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-schinazi-httpbis-wrap-up-01">https://datatracker.ietf.org/doc/html/draft-schinazi-httpbis-wrap-up-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6265">[RFC6265]</dt>
        <dd>
<span class="refAuthor">Barth, A.</span>, <span class="refTitle">"HTTP State Management Mechanism"</span>, <span class="seriesInfo">RFC 6265</span>, <span class="seriesInfo">DOI 10.17487/RFC6265</span>, <time datetime="2011-04" class="refDate">April 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6265">https://www.rfc-editor.org/rfc/rfc6265</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6797">[RFC6797]</dt>
        <dd>
<span class="refAuthor">Hodges, J.</span>, <span class="refAuthor">Jackson, C.</span>, and <span class="refAuthor">A. Barth</span>, <span class="refTitle">"HTTP Strict Transport Security (HSTS)"</span>, <span class="seriesInfo">RFC 6797</span>, <span class="seriesInfo">DOI 10.17487/RFC6797</span>, <time datetime="2012-11" class="refDate">November 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6797">https://www.rfc-editor.org/rfc/rfc6797</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7323">[RFC7323]</dt>
        <dd>
<span class="refAuthor">Borman, D.</span>, <span class="refAuthor">Braden, B.</span>, <span class="refAuthor">Jacobson, V.</span>, and <span class="refAuthor">R. Scheffenegger, Ed.</span>, <span class="refTitle">"TCP Extensions for High Performance"</span>, <span class="seriesInfo">RFC 7323</span>, <span class="seriesInfo">DOI 10.17487/RFC7323</span>, <time datetime="2014-09" class="refDate">September 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7323">https://www.rfc-editor.org/rfc/rfc7323</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7469">[RFC7469]</dt>
        <dd>
<span class="refAuthor">Evans, C.</span>, <span class="refAuthor">Palmer, C.</span>, and <span class="refAuthor">R. Sleevi</span>, <span class="refTitle">"Public Key Pinning Extension for HTTP"</span>, <span class="seriesInfo">RFC 7469</span>, <span class="seriesInfo">DOI 10.17487/RFC7469</span>, <time datetime="2015-04" class="refDate">April 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7469">https://www.rfc-editor.org/rfc/rfc7469</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7838">[RFC7838]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refAuthor">McManus, P.</span>, and <span class="refAuthor">J. Reschke</span>, <span class="refTitle">"HTTP Alternative Services"</span>, <span class="seriesInfo">RFC 7838</span>, <span class="seriesInfo">DOI 10.17487/RFC7838</span>, <time datetime="2016-04" class="refDate">April 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7838">https://www.rfc-editor.org/rfc/rfc7838</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8942">[RFC8942]</dt>
        <dd>
<span class="refAuthor">Grigorik, I.</span> and <span class="refAuthor">Y. Weiss</span>, <span class="refTitle">"HTTP Client Hints"</span>, <span class="seriesInfo">RFC 8942</span>, <span class="seriesInfo">DOI 10.17487/RFC8942</span>, <time datetime="2021-02" class="refDate">February 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8942">https://www.rfc-editor.org/rfc/rfc8942</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9297">[RFC9297]</dt>
      <dd>
<span class="refAuthor">Schinazi, D.</span> and <span class="refAuthor">L. Pardue</span>, <span class="refTitle">"HTTP Datagrams and the Capsule Protocol"</span>, <span class="seriesInfo">RFC 9297</span>, <span class="seriesInfo">DOI 10.17487/RFC9297</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9297">https://www.rfc-editor.org/rfc/rfc9297</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">Thanks to Amos Jeffries, Tommy Pauly, Kyle Nekritz, David Schinazi, and Kazuho Oku for close review and suggested changes.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Benjamin M. Schwartz</span></div>
<div dir="auto" class="left"><span class="org">Meta Platforms, Inc.</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ietf@bemasc.net" class="email">ietf@bemasc.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
