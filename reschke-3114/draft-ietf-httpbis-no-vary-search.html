<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Han,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>The No-Vary-Search HTTP Response Header Field</title>
<meta content="Domenic Denicola" name="author">
<meta content="Jeremy Roman" name="author">
<meta content="
       This specification defines a proposed HTTP response header field for changing how URL search parameters impact caching. 
    " name="description">
<meta content="xml2rfc 3.29.0" name="generator">
<meta content="http" name="keyword">
<meta content="caching" name="keyword">
<meta content="draft-ietf-httpbis-no-vary-search-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.29.0
    Python 3.12.11
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.6
    lxml 5.3.1
    platformdirs 4.3.8
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.4
    setuptools 80.9.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-httpbis-no-vary-search.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">No-Vary-Search</td>
<td class="right">June 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Denicola &amp; Roman</td>
<td class="center">Expires 25 December 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">HyperText Transfer Protocol</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-httpbis-no-vary-search-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-06-23" class="published">23 June 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-12-25">25 December 2025</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">D. Denicola</div>
<div class="org">Google LLC</div>
</div>
<div class="author">
      <div class="author-name">J. Roman</div>
<div class="org">Google LLC</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">The No-Vary-Search HTTP Response Header Field</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This specification defines a proposed HTTP response header field for changing how URL search parameters impact caching.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-no-vary-search.html">https://httpwg.org/http-extensions/draft-ietf-httpbis-no-vary-search.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-ietf-httpbis-no-vary-search/">https://datatracker.ietf.org/doc/draft-ietf-httpbis-no-vary-search/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        HTTP Working Group mailing list (<span><a href="mailto:ietf-http-wg@w3.org">mailto:ietf-http-wg@w3.org</a></span>),
        which is archived at <span><a href="https://lists.w3.org/Archives/Public/ietf-http-wg/">https://lists.w3.org/Archives/Public/ietf-http-wg/</a></span>.
        Working Group information can be found at <span><a href="https://httpwg.org/">https://httpwg.org/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/httpwg/http-extensions/labels/no-vary-search">https://github.com/httpwg/http-extensions/labels/no-vary-search</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 25 December 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-http-header-field-definitio" class="internal xref">HTTP header field definition</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-data-model" class="internal xref">Data model</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-parsing" class="internal xref">Parsing</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-parse-a-url-search-variance" class="internal xref">Parse a URL search variance</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-obtain-a-url-search-varianc" class="internal xref">Obtain a URL search variance</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.1">
                    <p id="section-toc.1-1.5.2.2.2.1.1"><a href="#section-5.2.1" class="auto internal xref">5.2.1</a>.  <a href="#name-examples" class="internal xref">Examples</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-parse-a-key" class="internal xref">Parse a key</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.1">
                    <p id="section-toc.1-1.5.2.3.2.1.1"><a href="#section-5.3.1" class="auto internal xref">5.3.1</a>.  <a href="#name-examples-2" class="internal xref">Examples</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-comparing" class="internal xref">Comparing</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-examples-3" class="internal xref">Examples</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-caching" class="internal xref">Caching</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-privacy-considerations" class="internal xref">Privacy Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-http-field-names" class="internal xref">HTTP Field Names</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="auto internal xref">11.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="auto internal xref">11.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-index" class="internal xref">Index</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">HTTP caching <span>[<a href="#HTTP-CACHING" class="cite xref">HTTP-CACHING</a>]</span> is based on reusing resources which match across a number of cache keys. One of the most prominent is the presented target URI (<span><a href="https://rfc-editor.org/rfc/rfc9110#section-7.1" class="relref">Section 7.1</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>). However, sometimes multiple URLs can represent the same resource. This leads to caches not always being as helpful as they could be: if the cache contains the resource under one URI, but the resource is then requested under another, the cached version will be ignored.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The <code>No-Vary-Search</code> HTTP header field tackles a specific subset of this general problem, for when a resource has multiple URLs which differ only in certain query components. It allows resources to declare that some or all parts of the query do not semantically affect the served resource, and thus can be ignored for cache matching purposes. For example, if the order of the query parameter keys do not semantically affect the served resource, this is indicated using<a href="#section-1-2" class="pilcrow">¶</a></p>
<div class="lang-http-message sourcecode" id="section-1-3">
<pre>
No-Vary-Search: key-order
</pre><a href="#section-1-3" class="pilcrow">¶</a>
</div>
<p id="section-1-4">If the specific query parameters (e.g., ones indicating something for analytics) do not semantically affect the served resource, this is indicated using<a href="#section-1-4" class="pilcrow">¶</a></p>
<div class="lang-http-message sourcecode" id="section-1-5">
<pre>
No-Vary-Search: params=("utm_source" "utm_medium" "utm_campaign")
</pre><a href="#section-1-5" class="pilcrow">¶</a>
</div>
<p id="section-1-6">And if the resource instead wants to take an allowlist-based approach, where only certain known query parameters semantically affect the served resource, they can use<a href="#section-1-6" class="pilcrow">¶</a></p>
<div class="lang-http-message sourcecode" id="section-1-7">
<pre>
No-Vary-Search: params, except=("productId")
</pre><a href="#section-1-7" class="pilcrow">¶</a>
</div>
<p id="section-1-8"><a href="#header-definition" class="auto internal xref">Section 3</a> defines the header, using the <span>[<a href="#STRUCTURED-FIELDS" class="cite xref">STRUCTURED-FIELDS</a>]</span> framework. <a href="#data-model" class="auto internal xref">Section 4</a> and <a href="#parsing" class="auto internal xref">Section 5</a> illustrate the data model for how the header can be represented in specifications, and the process for parsing the raw output from the structured field parser into that data model. <a href="#comparing" class="auto internal xref">Section 6</a> gives the key algorithm for comparing if two URLs are equivalent under the influence of the header; notably, it leans on the decomposition of the query component into keys and values given by the <a href="https://url.spec.whatwg.org/#concept-urlencoded">application/x-www-form-urlencoded</a> format specified in <span>[<a href="#WHATWG-URL" class="cite xref">WHATWG-URL</a>]</span>. Finally, <a href="#caching" class="auto internal xref">Section 7</a> explains how to modify <span>[<a href="#HTTP-CACHING" class="cite xref">HTTP-CACHING</a>]</span> to take into account this new equivalence.<a href="#section-1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">This document also adopts some conventions and notation typical in WHATWG and W3C usage, especially as it relates to algorithms. See <span>[<a href="#WHATWG-INFRA" class="cite xref">WHATWG-INFRA</a>]</span>, and in particular:<a href="#section-2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-3.1">
          <p id="section-2-3.1.1">its definition of lists, including the list literal notation « 1, 2, 3 ».<a href="#section-2-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.2">
          <p id="section-2-3.2.1">its definition of strings, including their representation as code units.<a href="#section-2-3.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-2-4">(Other concepts used are called out using inline references.)<a href="#section-2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="header-definition">
<section id="section-3">
      <h2 id="name-http-header-field-definitio">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-http-header-field-definitio" class="section-name selfRef">HTTP header field definition</a>
      </h2>
<p id="section-3-1">The <code>No-Vary-Search</code> HTTP header field is a structured field <span>[<a href="#STRUCTURED-FIELDS" class="cite xref">STRUCTURED-FIELDS</a>]</span> whose value <span class="bcp14">MUST</span> be a dictionary (<span><a href="https://rfc-editor.org/rfc/rfc8941#section-3.2" class="relref">Section 3.2</a> of [<a href="#STRUCTURED-FIELDS" class="cite xref">STRUCTURED-FIELDS</a>]</span>).<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">It has the following authoring conformance requirements:<a href="#section-3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-3.1">
          <p id="section-3-3.1.1">If present, the <code>key-order</code> entry's value <span class="bcp14">MUST</span> be a boolean (<span><a href="https://rfc-editor.org/rfc/rfc8941#section-3.3.6" class="relref">Section 3.3.6</a> of [<a href="#STRUCTURED-FIELDS" class="cite xref">STRUCTURED-FIELDS</a>]</span>).<a href="#section-3-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-3.2">
          <p id="section-3-3.2.1">If present, the <code>params</code> entry's value <span class="bcp14">MUST</span> be either a boolean (<span><a href="https://rfc-editor.org/rfc/rfc8941#section-3.3.6" class="relref">Section 3.3.6</a> of [<a href="#STRUCTURED-FIELDS" class="cite xref">STRUCTURED-FIELDS</a>]</span>) or an inner list (<span><a href="https://rfc-editor.org/rfc/rfc8941#section-3.1.1" class="relref">Section 3.1.1</a> of [<a href="#STRUCTURED-FIELDS" class="cite xref">STRUCTURED-FIELDS</a>]</span>).<a href="#section-3-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-3.3">
          <p id="section-3-3.3.1">If present, the <code>except</code> entry's value <span class="bcp14">MUST</span> be an inner list (<span><a href="https://rfc-editor.org/rfc/rfc8941#section-3.1.1" class="relref">Section 3.1.1</a> of [<a href="#STRUCTURED-FIELDS" class="cite xref">STRUCTURED-FIELDS</a>]</span>).<a href="#section-3-3.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-3.4">
          <p id="section-3-3.4.1">The <code>except</code> entry <span class="bcp14">MUST</span> only be present if the <code>params</code> entry is also present, and the <code>params</code> entry's value is the boolean value true.<a href="#section-3-3.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-3-4">The dictionary <span class="bcp14">MAY</span> contain entries whose keys are not one of <code>key-order</code>, <code>params</code>, and <code>except</code>, but their meaning is not defined by this specification. Implementations of this specification will ignore such entries (but future documents might assign meaning to such entries).<a href="#section-3-4" class="pilcrow">¶</a></p>
<aside id="section-3-5">
        <p id="section-3-5.1">As always, the authoring conformance requirements are not binding on implementations. Implementations instead need to implement the processing model given by the <span id="iref-obtain-a-url-search-varianc" class="iref"></span><a href="#obtain-a-url-search-variance" class="internal xref">obtain a URL search variance</a> algorithm (<a href="#obtain-a-url-search-variance" class="auto internal xref">Section 5.2</a>).<a href="#section-3-5.1" class="pilcrow">¶</a></p>
</aside>
</section>
</div>
<div id="data-model">
<section id="section-4">
      <h2 id="name-data-model">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-data-model" class="section-name selfRef">Data model</a>
      </h2>
<p id="section-4-1">A <em>URL search variance</em> consists of the following:<a href="#section-4-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-4-2">
        <dt id="section-4-2.1">no-vary params</dt>
        <dd style="margin-left: 1.5em" id="section-4-2.2">
          <p id="section-4-2.2.1">either the special value <strong>wildcard</strong> or a list of strings<a href="#section-4-2.2.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-4-2.3">vary params</dt>
        <dd style="margin-left: 1.5em" id="section-4-2.4">
          <p id="section-4-2.4.1">either the special value <strong>wildcard</strong> or a list of strings<a href="#section-4-2.4.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-4-2.5">vary on key order</dt>
        <dd style="margin-left: 1.5em" id="section-4-2.6">
          <p id="section-4-2.6.1">a boolean<a href="#section-4-2.6.1" class="pilcrow">¶</a></p>
</dd>
      <dd class="break"></dd>
</dl>
<p id="section-4-3"><span id="iref-default-url-search-variance" class="iref"></span>
The <em><span id="iref-default-url-search-variance-" class="iref"></span>default URL search variance</em> is a URL search variance whose no-vary params is an empty list, vary params is <strong>wildcard</strong>, and vary on key order is true.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">The <span id="iref-obtain-a-url-search-variance" class="iref"></span><a href="#obtain-a-url-search-variance" class="internal xref">obtain a URL search variance</a> algorithm (<a href="#obtain-a-url-search-variance" class="auto internal xref">Section 5.2</a>) ensures that all URL search variances obey the following constraints:<a href="#section-4-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-5.1">
          <p id="section-4-5.1.1">vary params is a list if and only if the no-vary params is <strong>wildcard</strong>; and<a href="#section-4-5.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-5.2">
          <p id="section-4-5.2.1">no-vary params is a list if and only if the vary params is <strong>wildcard</strong>.<a href="#section-4-5.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="parsing">
<section id="section-5">
      <h2 id="name-parsing">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-parsing" class="section-name selfRef">Parsing</a>
      </h2>
<div id="parse-a-url-search-variance">
<section id="section-5.1">
        <h3 id="name-parse-a-url-search-variance">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-parse-a-url-search-variance" class="section-name selfRef">Parse a URL search variance</a>
        </h3>
<p id="section-5.1-1"><span id="iref-parse-a-url-search-variance" class="iref"></span>
To <em><span id="iref-parse-a-url-search-variance-" class="iref"></span><a href="#parse-a-url-search-variance" class="internal xref">parse a URL search variance</a></em> given <em>value</em>:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.1-2">
<li id="section-5.1-2.1">
            <p id="section-5.1-2.1.1">If <em>value</em> is null, then return the <span id="iref-default-url-search-variance-7" class="iref"></span>default URL search variance.<a href="#section-5.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.1-2.2">
            <p id="section-5.1-2.2.1">Let <em>result</em> be a new URL search variance.<a href="#section-5.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.1-2.3">
            <p id="section-5.1-2.3.1">Set <em>result</em>'s vary on key order to true.<a href="#section-5.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.1-2.4">
            <p id="section-5.1-2.4.1">If <em>value</em>["<code>key-order</code>"] exists:<a href="#section-5.1-2.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.1-2.4.2">
<li id="section-5.1-2.4.2.1">
                <p id="section-5.1-2.4.2.1.1">If <em>value</em>["<code>key-order</code>"] is not a boolean, then return the <span id="iref-default-url-search-variance-8" class="iref"></span>default URL search variance.<a href="#section-5.1-2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-5.1-2.4.2.2">
                <p id="section-5.1-2.4.2.2.1">Set <em>result</em>'s vary on key order to the boolean negation of <em>value</em>["<code>key-order</code>"].<a href="#section-5.1-2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ol>
</li>
          <li id="section-5.1-2.5">
            <p id="section-5.1-2.5.1">If <em>value</em>["<code>params</code>"] exists:<a href="#section-5.1-2.5.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.1-2.5.2">
<li id="section-5.1-2.5.2.1">
                <p id="section-5.1-2.5.2.1.1">If <em>value</em>["<code>params</code>"] is a boolean:<a href="#section-5.1-2.5.2.1.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.1-2.5.2.1.2">
<li id="section-5.1-2.5.2.1.2.1">
                    <p id="section-5.1-2.5.2.1.2.1.1">If <em>value</em>["<code>params</code>"] is true, then:<a href="#section-5.1-2.5.2.1.2.1.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.1-2.5.2.1.2.1.2">
<li id="section-5.1-2.5.2.1.2.1.2.1">
                        <p id="section-5.1-2.5.2.1.2.1.2.1.1">Set <em>result</em>'s no-vary params to <strong>wildcard</strong>.<a href="#section-5.1-2.5.2.1.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                      <li id="section-5.1-2.5.2.1.2.1.2.2">
                        <p id="section-5.1-2.5.2.1.2.1.2.2.1">Set <em>result</em>'s vary params to the empty list.<a href="#section-5.1-2.5.2.1.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                    </ol>
</li>
                  <li id="section-5.1-2.5.2.1.2.2">
                    <p id="section-5.1-2.5.2.1.2.2.1">Otherwise:<a href="#section-5.1-2.5.2.1.2.2.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.1-2.5.2.1.2.2.2">
<li id="section-5.1-2.5.2.1.2.2.2.1">
                        <p id="section-5.1-2.5.2.1.2.2.2.1.1">Set <em>result</em>'s no-vary params to the empty list.<a href="#section-5.1-2.5.2.1.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                      <li id="section-5.1-2.5.2.1.2.2.2.2">
                        <p id="section-5.1-2.5.2.1.2.2.2.2.1">Set <em>result</em>'s vary params to <strong>wildcard</strong>.<a href="#section-5.1-2.5.2.1.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                    </ol>
</li>
                </ol>
</li>
              <li id="section-5.1-2.5.2.2">
                <p id="section-5.1-2.5.2.2.1">Otherwise, if <em>value</em>["<code>params</code>"] is an array:<a href="#section-5.1-2.5.2.2.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.1-2.5.2.2.2">
<li id="section-5.1-2.5.2.2.2.1">
                    <p id="section-5.1-2.5.2.2.2.1.1">If any item in <em>value</em>["<code>params</code>"] is not a string, then return the <span id="iref-default-url-search-variance-9" class="iref"></span>default URL search variance.<a href="#section-5.1-2.5.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li id="section-5.1-2.5.2.2.2.2">
                    <p id="section-5.1-2.5.2.2.2.2.1">Set <em>result</em>'s no-vary params to the result of applying <span id="iref-parse-a-key-10" class="iref"></span><a href="#parse-a-key" class="internal xref">parse a key</a> (<a href="#parse-a-key" class="auto internal xref">Section 5.3</a>) to each item in <em>value</em>["<code>params</code>"].<a href="#section-5.1-2.5.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li id="section-5.1-2.5.2.2.2.3">
                    <p id="section-5.1-2.5.2.2.2.3.1">Set <em>result</em>'s vary params to <strong>wildcard</strong>.<a href="#section-5.1-2.5.2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
                </ol>
</li>
              <li id="section-5.1-2.5.2.3">
                <p id="section-5.1-2.5.2.3.1">Otherwise, return the <span id="iref-default-url-search-variance-1" class="iref"></span>default URL search variance.<a href="#section-5.1-2.5.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ol>
</li>
          <li id="section-5.1-2.6">
            <p id="section-5.1-2.6.1">If <em>value</em>["<code>except</code>"] exists:<a href="#section-5.1-2.6.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.1-2.6.2">
<li id="section-5.1-2.6.2.1">
                <p id="section-5.1-2.6.2.1.1">If <em>value</em>["<code>params</code>"] is not true, then return the <span id="iref-default-url-search-variance-12" class="iref"></span>default URL search variance.<a href="#section-5.1-2.6.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-5.1-2.6.2.2">
                <p id="section-5.1-2.6.2.2.1">If <em>value</em>["<code>except</code>"] is not an array, then return the <span id="iref-default-url-search-variance-13" class="iref"></span>default URL search variance.<a href="#section-5.1-2.6.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-5.1-2.6.2.3">
                <p id="section-5.1-2.6.2.3.1">If any item in <em>value</em>["<code>except</code>"] is not a string, then return the <span id="iref-default-url-search-variance-14" class="iref"></span>default URL search variance.<a href="#section-5.1-2.6.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-5.1-2.6.2.4">
                <p id="section-5.1-2.6.2.4.1">Set <em>result</em>'s vary params to the result of applying <span id="iref-parse-a-key-15" class="iref"></span><a href="#parse-a-key" class="internal xref">parse a key</a> (<a href="#parse-a-key" class="auto internal xref">Section 5.3</a>) to each item in <em>value</em>["<code>except</code>"].<a href="#section-5.1-2.6.2.4.1" class="pilcrow">¶</a></p>
</li>
            </ol>
</li>
          <li id="section-5.1-2.7">
            <p id="section-5.1-2.7.1">Return <em>result</em>.<a href="#section-5.1-2.7.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<aside id="section-5.1-3">
          <p id="section-5.1-3.1">In general, this algorithm is strict and tends to return the <span id="iref-default-url-search-variance-16" class="iref"></span>default URL search variance whenever it sees something it doesn't recognize. This is because the <span id="iref-default-url-search-variance-17" class="iref"></span>default URL search variance behavior will just cause fewer cache hits, which is an acceptable fallback behavior.<a href="#section-5.1-3.1" class="pilcrow">¶</a></p>
<p id="section-5.1-3.2">However, unrecognized keys at the top level are ignored, to make it easier to extend this specification in the future. To avoid misbehavior with existing client software, such extensions will likely expand, rather than reduce, the set of requests that a cached response can match.<a href="#section-5.1-3.2" class="pilcrow">¶</a></p>
</aside>
<aside id="section-5.1-4">
          <p id="section-5.1-4.1">The input to this algorithm is generally obtained by parsing a structured field (<span><a href="https://rfc-editor.org/rfc/rfc8941#section-4.2" class="relref">Section 4.2</a> of [<a href="#STRUCTURED-FIELDS" class="cite xref">STRUCTURED-FIELDS</a>]</span>) using field_type "dictionary".<a href="#section-5.1-4.1" class="pilcrow">¶</a></p>
</aside>
</section>
</div>
<div id="obtain-a-url-search-variance">
<section id="section-5.2">
        <h3 id="name-obtain-a-url-search-varianc">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-obtain-a-url-search-varianc" class="section-name selfRef">Obtain a URL search variance</a>
        </h3>
<p id="section-5.2-1"><span id="iref-obtain-a-url-search-variance-" class="iref"></span>
To <em><span id="iref-obtain-a-url-search-variance-1" class="iref"></span><a href="#obtain-a-url-search-variance" class="internal xref">obtain a URL search variance</a></em> given a <a href="https://fetch.spec.whatwg.org/#concept-response">response</a> <em>response</em>:<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.2-2">
<li id="section-5.2-2.1">
            <p id="section-5.2-2.1.1">Let <em>fieldValue</em> be the result of <a href="https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header">getting a structured field value</a> <span>[<a href="#FETCH" class="cite xref">FETCH</a>]</span> given `<code>No-Vary-Search</code>` and "<code>dictionary</code>" from <em>response</em>'s header list.<a href="#section-5.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.2-2.2">
            <p id="section-5.2-2.2.1">Return the result of parsing a URL search variance (<a href="#parse-a-url-search-variance" class="auto internal xref">Section 5.1</a>) given <em>fieldValue</em>. <span id="iref-parse-a-url-search-variance-2" class="iref"></span><a href="#section-5.2-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<div id="examples">
<section id="section-5.2.1">
          <h4 id="name-examples">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-examples" class="section-name selfRef">Examples</a>
          </h4>
<p id="section-5.2.1-1">The following illustrates how various inputs are parsed, in terms of their impacting on the resulting no-vary params and vary params:<a href="#section-5.2.1-1" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
            <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Input</th>
                <th class="text-left" rowspan="1" colspan="1">Result</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>No-Vary-Search: params</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">no-vary params: <strong>wildcard</strong><br>vary params: (empty list)</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>No-Vary-Search: params=("a")</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">no-vary params: « "<code>a</code>" »<br>vary params: <strong>wildcard</strong>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>No-Vary-Search: params, except=("x")</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">no-vary params: <strong>wildcard</strong><br>vary params: « "<code>x</code>" »</td>
              </tr>
            </tbody>
          </table>
<p id="section-5.2.1-3">The following inputs are all invalid and will cause the <span id="iref-default-url-search-variance-2" class="iref"></span>default URL search variance to be returned:<a href="#section-5.2.1-3" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.2.1-4.1">
              <p id="section-5.2.1-4.1.1"><code>No-Vary-Search: unknown-key</code><a href="#section-5.2.1-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="compact" id="section-5.2.1-4.2">
              <p id="section-5.2.1-4.2.1"><code>No-Vary-Search: key-order="not a boolean"</code><a href="#section-5.2.1-4.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="compact" id="section-5.2.1-4.3">
              <p id="section-5.2.1-4.3.1"><code>No-Vary-Search: params="not a boolean or inner list"</code><a href="#section-5.2.1-4.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="compact" id="section-5.2.1-4.4">
              <p id="section-5.2.1-4.4.1"><code>No-Vary-Search: params=(not-a-string)</code><a href="#section-5.2.1-4.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="compact" id="section-5.2.1-4.5">
              <p id="section-5.2.1-4.5.1"><code>No-Vary-Search: params=("a"), except=("x")</code><a href="#section-5.2.1-4.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="compact" id="section-5.2.1-4.6">
              <p id="section-5.2.1-4.6.1"><code>No-Vary-Search: params=(), except=()</code><a href="#section-5.2.1-4.6.1" class="pilcrow">¶</a></p>
</li>
            <li class="compact" id="section-5.2.1-4.7">
              <p id="section-5.2.1-4.7.1"><code>No-Vary-Search: params=?0, except=("x")</code><a href="#section-5.2.1-4.7.1" class="pilcrow">¶</a></p>
</li>
            <li class="compact" id="section-5.2.1-4.8">
              <p id="section-5.2.1-4.8.1"><code>No-Vary-Search: params, except=(not-a-string)</code><a href="#section-5.2.1-4.8.1" class="pilcrow">¶</a></p>
</li>
            <li class="compact" id="section-5.2.1-4.9">
              <p id="section-5.2.1-4.9.1"><code>No-Vary-Search: params, except="not an inner list"</code><a href="#section-5.2.1-4.9.1" class="pilcrow">¶</a></p>
</li>
            <li class="compact" id="section-5.2.1-4.10">
              <p id="section-5.2.1-4.10.1"><code>No-Vary-Search: params, except=?1</code><a href="#section-5.2.1-4.10.1" class="pilcrow">¶</a></p>
</li>
            <li class="compact" id="section-5.2.1-4.11">
              <p id="section-5.2.1-4.11.1"><code>No-Vary-Search: except=("x")</code><a href="#section-5.2.1-4.11.1" class="pilcrow">¶</a></p>
</li>
            <li class="compact" id="section-5.2.1-4.12">
              <p id="section-5.2.1-4.12.1"><code>No-Vary-Search: except=()</code><a href="#section-5.2.1-4.12.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.2.1-5">The following inputs are valid, but somewhat unconventional. They are shown alongside their more conventional form.<a href="#section-5.2.1-5" class="pilcrow">¶</a></p>
<table class="center" id="table-2">
            <caption><a href="#table-2" class="selfRef">Table 2</a></caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Input</th>
                <th class="text-left" rowspan="1" colspan="1">Conventional form</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>No-Vary-Search: params=?1</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>No-Vary-Search: params</code>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>No-Vary-Search: key-order=?1</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>No-Vary-Search: key-order</code>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>No-Vary-Search: params, key-order, except=("x")</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>No-Vary-Search: key-order, params, except=("x")</code>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>No-Vary-Search: params=?0</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">(omit the header)</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>No-Vary-Search: params=()</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">(omit the header)</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>No-Vary-Search: key-order=?0</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">(omit the header)</td>
              </tr>
            </tbody>
          </table>
</section>
</div>
</section>
</div>
<div id="parse-a-key">
<section id="section-5.3">
        <h3 id="name-parse-a-key">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-parse-a-key" class="section-name selfRef">Parse a key</a>
        </h3>
<p id="section-5.3-1"><span id="iref-parse-a-key-22" class="iref"></span>
To <em><span id="iref-parse-a-key-23" class="iref"></span><a href="#parse-a-key" class="internal xref">parse a key</a></em> given an ASCII string <em>keyString</em>:<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.3-2">
<li id="section-5.3-2.1">
            <p id="section-5.3-2.1.1">Let <em>keyBytes</em> be the <a href="https://infra.spec.whatwg.org/#isomorphic-encode">isomorphic encoding</a> <span>[<a href="#WHATWG-INFRA" class="cite xref">WHATWG-INFRA</a>]</span> of <em>keyString</em>.<a href="#section-5.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-2.2">
            <p id="section-5.3-2.2.1">Replace any 0x2B (+) in <em>keyBytes</em> with 0x20 (SP).<a href="#section-5.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-2.3">
            <p id="section-5.3-2.3.1">Let <em>keyBytesDecoded</em> be the <a href="https://url.spec.whatwg.org/#percent-decode">percent-decoding</a> <span>[<a href="#WHATWG-URL" class="cite xref">WHATWG-URL</a>]</span> of <em>keyBytes</em>.<a href="#section-5.3-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-2.4">
            <p id="section-5.3-2.4.1">Let <em>keyStringDecoded</em> be the <a href="https://encoding.spec.whatwg.org/#utf-8-decode-without-bom">UTF-8 decoding without BOM</a> <span>[<a href="#WHATWG-ENCODING" class="cite xref">WHATWG-ENCODING</a>]</span> of <em>keyBytesDecoded</em>.<a href="#section-5.3-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-2.5">
            <p id="section-5.3-2.5.1">Return <em>keyStringDecoded</em>.<a href="#section-5.3-2.5.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<div id="examples-1">
<section id="section-5.3.1">
          <h4 id="name-examples-2">
<a href="#section-5.3.1" class="section-number selfRef">5.3.1. </a><a href="#name-examples-2" class="section-name selfRef">Examples</a>
          </h4>
<p id="section-5.3.1-1">The <span id="iref-parse-a-key-24" class="iref"></span><a href="#parse-a-key" class="internal xref">parse a key</a> algorithm allows encoding non-ASCII key strings in the ASCII structured header format, similar to how the <a href="https://url.spec.whatwg.org/#concept-urlencoded">application/x-www-form-urlencoded</a> format <span>[<a href="#WHATWG-URL" class="cite xref">WHATWG-URL</a>]</span> allows encoding an entire entry list of keys and values in ASCII URL format. For example,<a href="#section-5.3.1-1" class="pilcrow">¶</a></p>
<div class="lang-http-message sourcecode" id="section-5.3.1-2">
<pre>
No-Vary-Search: params=("%C3%A9+%E6%B0%97")
</pre><a href="#section-5.3.1-2" class="pilcrow">¶</a>
</div>
<p id="section-5.3.1-3">will result in a URL search variance whose vary params are « "<code>é 気</code>" ». As explained in a later example, the canonicalization process during equivalence testing means this will treat as equivalent URL strings such as:<a href="#section-5.3.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.1-4.1">
              <p id="section-5.3.1-4.1.1"><code>https://example.com/?é 気=1</code><a href="#section-5.3.1-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.3.1-4.2">
              <p id="section-5.3.1-4.2.1"><code>https://example.com/?é+気=2</code><a href="#section-5.3.1-4.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.3.1-4.3">
              <p id="section-5.3.1-4.3.1"><code>https://example.com/?%C3%A9%20気=3</code><a href="#section-5.3.1-4.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.3.1-4.4">
              <p id="section-5.3.1-4.4.1"><code>https://example.com/?%C3%A9+%E6%B0%97=4</code><a href="#section-5.3.1-4.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.3.1-5">and so on, since they all are <a href="https://url.spec.whatwg.org/#concept-urlencoded-parser">parsed</a> <span>[<a href="#WHATWG-URL" class="cite xref">WHATWG-URL</a>]</span> to having the same key "<code>é 気</code>".<a href="#section-5.3.1-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="comparing">
<section id="section-6">
      <h2 id="name-comparing">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-comparing" class="section-name selfRef">Comparing</a>
      </h2>
<p id="section-6-1"><span id="iref-equivalent-modulo-search-va" class="iref"></span>
Two <a href="https://url.spec.whatwg.org/#concept-url">URLs</a> <span>[<a href="#WHATWG-URL" class="cite xref">WHATWG-URL</a>]</span> <em>urlA</em> and <em>urlB</em> are <em>equivalent modulo search variance</em> given a URL search variance <em>searchVariance</em> if the following algorithm returns true:<a href="#section-6-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6-2">
<li id="section-6-2.1">
          <p id="section-6-2.1.1">If the scheme, username, password, host, port, or path of <em>urlA</em> and <em>urlB</em> differ, then return false.<a href="#section-6-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-6-2.2">
          <p id="section-6-2.2.1">If <em>searchVariance</em> is equivalent to the <span id="iref-default-url-search-variance-26" class="iref"></span>default URL search variance, then:<a href="#section-6-2.2.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6-2.2.2">
<li id="section-6-2.2.2.1">
              <p id="section-6-2.2.2.1.1">If <em>urlA</em>'s query equals <em>urlB</em>'s query, then return true.<a href="#section-6-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-6-2.2.2.2">
              <p id="section-6-2.2.2.2.1">Return false.<a href="#section-6-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-6-2.2.3">
In this case, even URL pairs that might appear the same after running the <a href="https://url.spec.whatwg.org/#concept-urlencoded-parser">application/x-www-form-urlencoded parser</a> <span>[<a href="#WHATWG-URL" class="cite xref">WHATWG-URL</a>]</span> on their queries, such as <code>https://example.com/a</code> and <code>https://example.com/a?</code>, or <code>https://example.com/foo?a=b&amp;&amp;&amp;c</code> and <code>https://example.com/foo?a=b&amp;c=</code>, will be treated as inequivalent.<a href="#section-6-2.2.3" class="pilcrow">¶</a></p>
</li>
        <li id="section-6-2.3">
          <p id="section-6-2.3.1">Let <em>searchParamsA</em> and <em>searchParamsB</em> be empty lists.<a href="#section-6-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-6-2.4">
          <p id="section-6-2.4.1">If <em>urlA</em>'s query is not null, then set <em>searchParamsA</em> to the result of running the <a href="https://url.spec.whatwg.org/#concept-urlencoded-parser">application/x-www-form-urlencoded parser</a> <span>[<a href="#WHATWG-URL" class="cite xref">WHATWG-URL</a>]</span> given the <a href="https://infra.spec.whatwg.org/#isomorphic-encode">isomorphic encoding</a> <span>[<a href="#WHATWG-INFRA" class="cite xref">WHATWG-INFRA</a>]</span> of <em>urlA</em>'s query.<a href="#section-6-2.4.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-6-2.5">
          <p id="section-6-2.5.1">If <em>urlB</em>'s query is not null, then set <em>searchParamsB</em> to the result of running the <a href="https://url.spec.whatwg.org/#concept-urlencoded-parser">application/x-www-form-urlencoded parser</a> <span>[<a href="#WHATWG-URL" class="cite xref">WHATWG-URL</a>]</span> given the <a href="https://infra.spec.whatwg.org/#isomorphic-encode">isomorphic encoding</a> <span>[<a href="#WHATWG-INFRA" class="cite xref">WHATWG-INFRA</a>]</span> of <em>urlB</em>'s query.<a href="#section-6-2.5.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-6-2.6">
          <p id="section-6-2.6.1">If <em>searchVariance</em>'s no-vary params is a list, then:<a href="#section-6-2.6.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6-2.6.2">
<li id="section-6-2.6.2.1">
              <p id="section-6-2.6.2.1.1">Set <em>searchParamsA</em> to a list containing those items <em>pair</em> in <em>searchParamsA</em> where <em>searchVariance</em>'s no-vary params does not contain <em>pair</em>[0].<a href="#section-6-2.6.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-6-2.6.2.2">
              <p id="section-6-2.6.2.2.1">Set <em>searchParamsB</em> to a list containing those items <em>pair</em> in <em>searchParamsB</em> where <em>searchVariance</em>'s no-vary params does not contain <em>pair</em>[0].<a href="#section-6-2.6.2.2.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</li>
        <li id="section-6-2.7">
          <p id="section-6-2.7.1">Otherwise, if <em>searchVariance</em>'s vary params is a list, then:<a href="#section-6-2.7.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6-2.7.2">
<li id="section-6-2.7.2.1">
              <p id="section-6-2.7.2.1.1">Set <em>searchParamsA</em> to a list containing those items <em>pair</em> in <em>searchParamsA</em> where <em>searchVariance</em>'s vary params contains <em>pair</em>[0].<a href="#section-6-2.7.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-6-2.7.2.2">
              <p id="section-6-2.7.2.2.1">Set <em>searchParamsB</em> to a list containing those items <em>pair</em> in <em>searchParamsB</em> where <em>searchVariance</em>'s vary params contains <em>pair</em>[0].<a href="#section-6-2.7.2.2.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</li>
        <li id="section-6-2.8">
          <p id="section-6-2.8.1">If <em>searchVariance</em>'s vary on key order is false, then:<a href="#section-6-2.8.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6-2.8.2">
<li id="section-6-2.8.2.1">
              <p id="section-6-2.8.2.1.1">Let <em>keyLessThan</em> be an algorithm taking as inputs two pairs (<em>keyA</em>, <em>valueA</em>) and (<em>keyB</em>, <em>valueB</em>), which returns whether <em>keyA</em> is <a href="https://infra.spec.whatwg.org/#code-unit-less-than">code unit less than</a> <span>[<a href="#WHATWG-INFRA" class="cite xref">WHATWG-INFRA</a>]</span> <em>keyB</em>.<a href="#section-6-2.8.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-6-2.8.2.2">
              <p id="section-6-2.8.2.2.1">Set <em>searchParamsA</em> to the result of sorting <em>searchParamsA</em> in ascending order with <em>keyLessThan</em>.<a href="#section-6-2.8.2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-6-2.8.2.3">
              <p id="section-6-2.8.2.3.1">Set <em>searchParamsB</em> to the result of sorting <em>searchParamsB</em> in ascending order with <em>keyLessThan</em>.<a href="#section-6-2.8.2.3.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</li>
        <li id="section-6-2.9">
          <p id="section-6-2.9.1">If <em>searchParamsA</em>'s size is not equal to <em>searchParamsB</em>'s size, then return false.<a href="#section-6-2.9.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-6-2.10">
          <p id="section-6-2.10.1">Let <em>i</em> be 0.<a href="#section-6-2.10.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-6-2.11">
          <p id="section-6-2.11.1">While <em>i</em> &lt; <em>searchParamsA</em>'s size:<a href="#section-6-2.11.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6-2.11.2">
<li id="section-6-2.11.2.1">
              <p id="section-6-2.11.2.1.1">If <em>searchParamsA</em>[<em>i</em>][0] does not equal <em>searchParamsB</em>[<em>i</em>][0], then return false.<a href="#section-6-2.11.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-6-2.11.2.2">
              <p id="section-6-2.11.2.2.1">If <em>searchParamsA</em>[<em>i</em>][1] does not equal <em>searchParamsB</em>[<em>i</em>][1], then return false.<a href="#section-6-2.11.2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-6-2.11.2.3">
              <p id="section-6-2.11.2.3.1">Set <em>i</em> to <em>i</em> + 1.<a href="#section-6-2.11.2.3.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</li>
        <li id="section-6-2.12">
          <p id="section-6-2.12.1">Return true.<a href="#section-6-2.12.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<div id="examples-2">
<section id="section-6.1">
        <h3 id="name-examples-3">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-examples-3" class="section-name selfRef">Examples</a>
        </h3>
<p id="section-6.1-1">Due to how the application/x-www-form-urlencoded parser canonicalizes query strings, there are some cases where query strings which do not appear obviously equivalent, will end up being treated as equivalent after parsing.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">So, for example, given any non-default value for <code>No-Vary-Search</code>, such as <code>No-Vary-Search: key-order</code>, we will have the following equivalences:<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-6.1-3">
          <dt id="section-6.1-3.1">
        <code>https://example.com</code>
            <br>
            <code>https://example.com/?</code>
          </dt>
          <dd style="margin-left: 1.5em" id="section-6.1-3.2">A null query is parsed the same as an empty string<a href="#section-6.1-3.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-6.1-3.3">
        <code>https://example.com/?a=x</code>
            <br>
            <code>https://example.com/?%61=%78</code>
          </dt>
          <dd style="margin-left: 1.5em" id="section-6.1-3.4">Parsing performs percent-decoding<a href="#section-6.1-3.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-6.1-3.5">
        <code>https://example.com/?a=é</code>
            <br>
            <code>https://example.com/?a=%C3%A9</code>
          </dt>
          <dd style="margin-left: 1.5em" id="section-6.1-3.6">Parsing performs percent-decoding<a href="#section-6.1-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-6.1-3.7">
        <code>https://example.com/?a=%f6</code>
            <br>
            <code>https://example.com/?a=%ef%bf%bd</code>
          </dt>
          <dd style="margin-left: 1.5em" id="section-6.1-3.8">Both values are parsed as U+FFFD (�)<a href="#section-6.1-3.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-6.1-3.9">
        <code>https://example.com/?a=x&amp;&amp;&amp;&amp;</code>
            <br>
            <code>https://example.com/?a=x</code>
          </dt>
          <dd style="margin-left: 1.5em" id="section-6.1-3.10">Parsing splits on     <code>&amp;</code>
 and discards empty strings<a href="#section-6.1-3.10" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-6.1-3.11">
        <code>https://example.com/?a=</code>
            <br>
            <code>https://example.com/?a</code>
          </dt>
          <dd style="margin-left: 1.5em" id="section-6.1-3.12">Both parse as having an empty string value for     <code>a</code><a href="#section-6.1-3.12" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-6.1-3.13">
        <code>https://example.com/?a=%20</code>
            <br>
            <code>https://example.com/?a=+</code>
            <br>
            <code>https://example.com/?a= &amp;</code>
          </dt>
          <dd style="margin-left: 1.5em" id="section-6.1-3.14">
            <code>+</code>
 and     <code>%20</code>
 are both parsed as U+0020 SPACE<a href="#section-6.1-3.14" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="caching">
<section id="section-7">
      <h2 id="name-caching">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-caching" class="section-name selfRef">Caching</a>
      </h2>
<p id="section-7-1">If a cache <span>[<a href="#HTTP-CACHING" class="cite xref">HTTP-CACHING</a>]</span> implements this specification, the presented target URI requirement in <span><a href="https://rfc-editor.org/rfc/rfc9111#section-4" class="relref">Section 4</a> of [<a href="#HTTP-CACHING" class="cite xref">HTTP-CACHING</a>]</span> is replaced with:<a href="#section-7-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-2.1">
          <p id="section-7-2.1.1">one of the following:<a href="#section-7-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-2.1.2.1">
              <p id="section-7-2.1.2.1.1">the presented target URI (<span><a href="https://rfc-editor.org/rfc/rfc9110#section-7.1" class="relref">Section 7.1</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>) and that of the stored response match, or<a href="#section-7-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7-2.1.2.2">
              <p id="section-7-2.1.2.2.1">the presented target URI and that of the stored response are equivalent modulo search variance (<a href="#comparing" class="auto internal xref">Section 6</a>), given the variance obtained (<a href="#obtain-a-url-search-variance" class="auto internal xref">Section 5.2</a>) from the stored response.<a href="#section-7-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
      </ul>
<p id="section-7-3">Cache implementations <span class="bcp14">MAY</span> fail to reuse a stored response whose target URI matches <em>only</em> modulo URL search variance, if the cache has more recently stored a response which:<a href="#section-7-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-4.1">
          <p id="section-7-4.1.1">has a target URI which is equal to the presented target URI, excluding the query, and<a href="#section-7-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-4.2">
          <p id="section-7-4.2.1">has a non-empty value for the <code>No-Vary-Search</code> field, and<a href="#section-7-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-4.3">
          <p id="section-7-4.3.1">has a <code>No-Vary-Search</code> field value different from the stored response being considered for reuse.<a href="#section-7-4.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<aside id="section-7-5">
        <p id="section-7-5.1">Caches aren't required to reuse stored responses, generally. However, the above expressly empowers caches to, if it is advantageous for performance or other reasons, search a smaller number of stored responses.<a href="#section-7-5.1" class="pilcrow">¶</a></p>
<p id="section-7-5.2">That is, because caches might store more than one response for a given pathname, they need a way to efficiently look up the No-Vary-Search value without accessing all cached responses. Such a cache might take steps like the following to identify a stored response in a performant way, before checking the other conditions in <span><a href="https://rfc-editor.org/rfc/rfc9111#section-4" class="relref">Section 4</a> of [<a href="#HTTP-CACHING" class="cite xref">HTTP-CACHING</a>]</span>:<a href="#section-7-5.2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7-5.3">
<li id="section-7-5.3.1">
            <p id="section-7-5.3.1.1">Let exactMatch be cache[presentedTargetURI]. If it is a stored response that can be reused, return it.<a href="#section-7-5.3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7-5.3.2">
            <p id="section-7-5.3.2.1">Let targetPath be presentedTargetURI, with query parameters removed.<a href="#section-7-5.3.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7-5.3.3">
            <p id="section-7-5.3.3.1">Let lastNVS be mostRecentNVS[targetPath]. If it does not exist, return null.<a href="#section-7-5.3.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7-5.3.4">
            <p id="section-7-5.3.4.1">Let simplifiedURL be the result of simplifying presentedTargetURI according to lastNVS (by removing query parameters which are not significant, and stable sorting parameters by key, if key order is to be be ignored).<a href="#section-7-5.3.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7-5.3.5">
            <p id="section-7-5.3.5.1">Let nvsMatch be cache[simplifiedURL]. If it does not exist, return null. (It is assumed that this was written when storing in the cache, in addition to the exact URL.)<a href="#section-7-5.3.5.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7-5.3.6">
            <p id="section-7-5.3.6.1">Let searchVariance be obtained (<a href="#obtain-a-url-search-variance" class="auto internal xref">Section 5.2</a>) from nvsMatch.<a href="#section-7-5.3.6.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7-5.3.7">
            <p id="section-7-5.3.7.1">If nvsMatch's target URI and presentedTargetURI are not equivalent modulo search variance (<a href="#comparing" class="auto internal xref">Section 6</a>) given searchVariance, then return null.<a href="#section-7-5.3.7.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7-5.3.8">
            <p id="section-7-5.3.8.1">If nvsMatch is a stored response that can be reused, return it. Otherwise, return null.<a href="#section-7-5.3.8.1" class="pilcrow">¶</a></p>
</li>
        </ol>
</aside>
<p id="section-7-6">To aid cache implementation efficiency, servers <span class="bcp14">SHOULD NOT</span> send different non-empty values for the <code>No-Vary-Search</code> field in response to requests for a given pathname over time, unless there is a need to update how they handle the query component. Doing so would cause cache implementations that use a strategy like the above to miss some stored responses that could otherwise have been reused.<a href="#section-7-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-8">
      <h2 id="name-security-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-8-1">The main risk to be aware of is the impact of mismatched URLs. In particular, this could cause the user to see a response that was originally fetched from a URL different from the one displayed when they hovered a link, or the URL displayed in the URL bar.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">However, since the impact is limited to query parameters, this does not cross the relevant security boundary, which is the <a href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin">origin</a> <span>[<a href="#HTML" class="cite xref">HTML</a>]</span>. (Or perhaps just the <a href="https://url.spec.whatwg.org/#concept-url-host">host</a>, from <a href="https://url.spec.whatwg.org/#url-rendering-simplification">the perspective of web browser security UI</a>. <span>[<a href="#WHATWG-URL" class="cite xref">WHATWG-URL</a>]</span>) Indeed, we have already given origins complete control over how they present the (URL, reponse body) pair, including on the client side via technology such as <a href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-history-replacestate">history.replaceState()</a> or service workers.<a href="#section-8-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="privacy-considerations">
<section id="section-9">
      <h2 id="name-privacy-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-privacy-considerations" class="section-name selfRef">Privacy Considerations</a>
      </h2>
<p id="section-9-1">This proposal is adjacent to the highly-privacy-relevant space of <a href="https://privacycg.github.io/nav-tracking-mitigations/#terminology">navigational tracking</a>, which often uses query parameters to pass along user identifiers. However, we believe this proposal itself does not have privacy impacts. It does not interfere with <a href="https://privacycg.github.io/nav-tracking-mitigations/#deployed-mitigations">existing navigational tracking mitigations</a>, or any known future ones being contemplated. Indeed, if a page were to encode user identifiers in its URL, the only ability this proposal gives is to <em>reduce</em> such user tracking by preventing server processing of such user IDs (since the server is bypassed in favor of the cache). <span>[<a href="#NAV-TRACKING-MITIGATIONS" class="cite xref">NAV-TRACKING-MITIGATIONS</a>]</span><a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-10">
      <h2 id="name-iana-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-10-1">IANA should do the following:<a href="#section-10-1" class="pilcrow">¶</a></p>
<div id="http-field-names">
<section id="section-10.1">
        <h3 id="name-http-field-names">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-http-field-names" class="section-name selfRef">HTTP Field Names</a>
        </h3>
<p id="section-10.1-1">Enter the following into the Hypertext Transfer Protocol (HTTP) Field Name Registry:<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-10.1-2">
          <dt id="section-10.1-2.1">Field Name</dt>
          <dd style="margin-left: 1.5em" id="section-10.1-2.2">
            <p id="section-10.1-2.2.1"><code>No-Vary-Search</code><a href="#section-10.1-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-10.1-2.3">Status</dt>
          <dd style="margin-left: 1.5em" id="section-10.1-2.4">
            <p id="section-10.1-2.4.1">permanent<a href="#section-10.1-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-10.1-2.5">Structured Type</dt>
          <dd style="margin-left: 1.5em" id="section-10.1-2.6">
            <p id="section-10.1-2.6.1">Dictionary<a href="#section-10.1-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-10.1-2.7">Reference</dt>
          <dd style="margin-left: 1.5em" id="section-10.1-2.8">
            <p id="section-10.1-2.8.1">this document<a href="#section-10.1-2.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-10.1-2.9">Comments</dt>
          <dd style="margin-left: 1.5em" id="section-10.1-2.10">
            <p id="section-10.1-2.10.1">(none)<a href="#section-10.1-2.10.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-11">
      <h2 id="name-references">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-11.1">
        <h3 id="name-normative-references">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="FETCH">[FETCH]</dt>
        <dd>
<span class="refAuthor">van Kesteren, A.</span>, <span class="refTitle">"Fetch Living Standard"</span>, <span>n.d.</span>, <span>&lt;<a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>&gt;</span>. <span class="annotation">WHATWG</span>
        </dd>
<dd class="break"></dd>
<dt id="HTTP">[HTTP]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP Semantics"</span>, <span class="seriesInfo">STD 97</span>, <span class="seriesInfo">RFC 9110</span>, <span class="seriesInfo">DOI 10.17487/RFC9110</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9110">https://www.rfc-editor.org/rfc/rfc9110</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HTTP-CACHING">[HTTP-CACHING]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP Caching"</span>, <span class="seriesInfo">STD 98</span>, <span class="seriesInfo">RFC 9111</span>, <span class="seriesInfo">DOI 10.17487/RFC9111</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9111">https://www.rfc-editor.org/rfc/rfc9111</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="STRUCTURED-FIELDS">[STRUCTURED-FIELDS]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span> and <span class="refAuthor">P. Kamp</span>, <span class="refTitle">"Structured Field Values for HTTP"</span>, <span class="seriesInfo">RFC 8941</span>, <span class="seriesInfo">DOI 10.17487/RFC8941</span>, <time datetime="2021-02" class="refDate">February 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8941">https://www.rfc-editor.org/rfc/rfc8941</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="WHATWG-ENCODING">[WHATWG-ENCODING]</dt>
        <dd>
<span class="refAuthor">van Kesteren, A.</span>, <span class="refTitle">"Encoding Living Standard"</span>, <span>n.d.</span>, <span>&lt;<a href="https://encoding.spec.whatwg.org/">https://encoding.spec.whatwg.org/</a>&gt;</span>. <span class="annotation">WHATWG</span>
        </dd>
<dd class="break"></dd>
<dt id="WHATWG-INFRA">[WHATWG-INFRA]</dt>
        <dd>
<span class="refAuthor">van Kesteren, A.</span> and <span class="refAuthor">D. Denicola</span>, <span class="refTitle">"Infra Living Standard"</span>, <span>n.d.</span>, <span>&lt;<a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>&gt;</span>. <span class="annotation">WHATWG</span>
        </dd>
<dd class="break"></dd>
<dt id="WHATWG-URL">[WHATWG-URL]</dt>
      <dd>
<span class="refAuthor">van Kesteren, A.</span>, <span class="refTitle">"URL Living Standard"</span>, <span>n.d.</span>, <span>&lt;<a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>&gt;</span>. <span class="annotation">WHATWG</span>
        </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-11.2">
        <h3 id="name-informative-references">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="HTML">[HTML]</dt>
        <dd>
<span class="refAuthor">van Kesteren, A.</span>, <span class="refTitle">"HTML Living Standard"</span>, <span>n.d.</span>, <span>&lt;<a href="https://html.spec.whatwg.org/">https://html.spec.whatwg.org/</a>&gt;</span>. <span class="annotation">WHATWG</span>
        </dd>
<dd class="break"></dd>
<dt id="NAV-TRACKING-MITIGATIONS">[NAV-TRACKING-MITIGATIONS]</dt>
      <dd>
<span class="refAuthor">Snyder, P.</span> and <span class="refAuthor">J. Yasskin</span>, <span class="refTitle">"Navigational-Tracking Mitigations"</span>, <span>n.d.</span>, <span>&lt;<a href="https://privacycg.github.io/nav-tracking-mitigations/">https://privacycg.github.io/nav-tracking-mitigations/</a>&gt;</span>. <span class="annotation">W3C Privacy CG</span>
        </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">TODO acknowledge.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="appendix-B">
      <h2 id="name-index">
<a href="#name-index" class="section-name selfRef">Index</a>
      </h2>
<div id="rfc.index.index">
<p id="appendix-B-1">
        <a href="#rfc.index.u68" class="internal xref">D</a>
        <a href="#rfc.index.u69" class="internal xref">E</a>
        <a href="#rfc.index.u79" class="internal xref">O</a>
        <a href="#rfc.index.u80" class="internal xref">P</a><a href="#appendix-B-1" class="pilcrow">¶</a></p>
</div>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="appendix-B-2.1">
          <div id="rfc.index.u68">
<p id="appendix-B-2.1.1" class="keepWithNext">
            <a href="#rfc.index.u68" class="internal xref">D</a><a href="#appendix-B-2.1.1" class="pilcrow">¶</a></p>
</div>
<ul class="compact normal ulEmpty">
<li class="compact normal ulEmpty" id="appendix-B-2.1.2.1">
              <span class="break"></span><dl class="dlCompact dlParallel" id="appendix-B-2.1.2.1.1">
                <dt id="appendix-B-2.1.2.1.1.1">default URL search variance</dt>
                <dd style="margin-left: 1.5em" id="appendix-B-2.1.2.1.1.2">
                  <p id="appendix-B-2.1.2.1.1.2.1">
                    <strong><em><a href="#section-4-3" class="auto internal xref">Section 4, Paragraph 3</a></em></strong>; 
<a href="#section-5.1-2.1.1" class="auto internal xref">Section 5.1, Paragraph 2.1.1</a>; 
<a href="#section-5.1-2.4.2.1.1" class="auto internal xref">Section 5.1, Paragraph 2.4.2.1.1</a>; 
<a href="#section-5.1-2.5.2.2.2.1.1" class="auto internal xref">Section 5.1, Paragraph 2.5.2.2.2.1.1</a>; 
<a href="#section-5.1-2.5.2.3.1" class="auto internal xref">Section 5.1, Paragraph 2.5.2.3.1</a>; 
<a href="#section-5.1-2.6.2.1.1" class="auto internal xref">Section 5.1, Paragraph 2.6.2.1.1</a>; 
<a href="#section-5.1-2.6.2.2.1" class="auto internal xref">Section 5.1, Paragraph 2.6.2.2.1</a>; 
<a href="#section-5.1-2.6.2.3.1" class="auto internal xref">Section 5.1, Paragraph 2.6.2.3.1</a>; 
<a href="#section-5.1-3.1" class="auto internal xref">Section 5.1, Paragraph 3.1</a>; 
<a href="#section-5.2.1-3" class="auto internal xref">Section 5.2.1, Paragraph 3</a>; 
<a href="#section-6-2.2.1" class="auto internal xref">Section 6, Paragraph 2.2.1</a><a href="#appendix-B-2.1.2.1.1.2.1" class="pilcrow">¶</a></p>
</dd>
              <dd class="break"></dd>
</dl>
</li>
          </ul>
</li>
        <li class="normal ulEmpty" id="appendix-B-2.2">
          <div id="rfc.index.u69">
<p id="appendix-B-2.2.1" class="keepWithNext">
            <a href="#rfc.index.u69" class="internal xref">E</a><a href="#appendix-B-2.2.1" class="pilcrow">¶</a></p>
</div>
<ul class="compact normal ulEmpty">
<li class="compact normal ulEmpty" id="appendix-B-2.2.2.1">
              <span class="break"></span><dl class="dlCompact dlParallel" id="appendix-B-2.2.2.1.1">
                <dt id="appendix-B-2.2.2.1.1.1">equivalent modulo search variance</dt>
                <dd style="margin-left: 1.5em" id="appendix-B-2.2.2.1.1.2">
                  <p id="appendix-B-2.2.2.1.1.2.1">
                    <strong><em><a href="#section-6-1" class="auto internal xref">Section 6, Paragraph 1</a></em></strong><a href="#appendix-B-2.2.2.1.1.2.1" class="pilcrow">¶</a></p>
</dd>
              <dd class="break"></dd>
</dl>
</li>
          </ul>
</li>
        <li class="normal ulEmpty" id="appendix-B-2.3">
          <div id="rfc.index.u79">
<p id="appendix-B-2.3.1" class="keepWithNext">
            <a href="#rfc.index.u79" class="internal xref">O</a><a href="#appendix-B-2.3.1" class="pilcrow">¶</a></p>
</div>
<ul class="compact normal ulEmpty">
<li class="compact normal ulEmpty" id="appendix-B-2.3.2.1">
              <span class="break"></span><dl class="dlCompact dlParallel" id="appendix-B-2.3.2.1.1">
                <dt id="appendix-B-2.3.2.1.1.1">obtain a URL search variance</dt>
                <dd style="margin-left: 1.5em" id="appendix-B-2.3.2.1.1.2">
                  <p id="appendix-B-2.3.2.1.1.2.1">
                    <a href="#section-3-5.1" class="auto internal xref">Section 3, Paragraph 5.1</a>; 
<a href="#section-4-4" class="auto internal xref">Section 4, Paragraph 4</a>; 
<strong><em><a href="#section-5.2-1" class="auto internal xref">Section 5.2, Paragraph 1</a></em></strong><a href="#appendix-B-2.3.2.1.1.2.1" class="pilcrow">¶</a></p>
</dd>
              <dd class="break"></dd>
</dl>
</li>
          </ul>
</li>
        <li class="normal ulEmpty" id="appendix-B-2.4">
          <div id="rfc.index.u80">
<p id="appendix-B-2.4.1" class="keepWithNext">
            <a href="#rfc.index.u80" class="internal xref">P</a><a href="#appendix-B-2.4.1" class="pilcrow">¶</a></p>
</div>
<ul class="compact normal ulEmpty">
<li class="compact normal ulEmpty" id="appendix-B-2.4.2.1">
              <span class="break"></span><dl class="dlCompact dlParallel" id="appendix-B-2.4.2.1.1">
                <dt id="appendix-B-2.4.2.1.1.1">parse a key</dt>
                <dd style="margin-left: 1.5em" id="appendix-B-2.4.2.1.1.2">
                  <p id="appendix-B-2.4.2.1.1.2.1">
                    <a href="#section-5.1-2.5.2.2.2.2.1" class="auto internal xref">Section 5.1, Paragraph 2.5.2.2.2.2.1</a>; 
<a href="#section-5.1-2.6.2.4.1" class="auto internal xref">Section 5.1, Paragraph 2.6.2.4.1</a>; 
<strong><em><a href="#section-5.3-1" class="auto internal xref">Section 5.3, Paragraph 1</a></em></strong>; 
<a href="#section-5.3.1-1" class="auto internal xref">Section 5.3.1, Paragraph 1</a><a href="#appendix-B-2.4.2.1.1.2.1" class="pilcrow">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt id="appendix-B-2.4.2.1.1.3">parse a URL search variance</dt>
                <dd style="margin-left: 1.5em" id="appendix-B-2.4.2.1.1.4">
                  <p id="appendix-B-2.4.2.1.1.4.1">
                    <strong><em><a href="#section-5.1-1" class="auto internal xref">Section 5.1, Paragraph 1</a></em></strong>; 
<a href="#section-5.2-2.2.1" class="auto internal xref">Section 5.2, Paragraph 2.2.1</a><a href="#appendix-B-2.4.2.1.1.4.1" class="pilcrow">¶</a></p>
</dd>
              <dd class="break"></dd>
</dl>
</li>
          </ul>
</li>
      </ul>
</section>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Domenic Denicola</span></div>
<div dir="auto" class="left"><span class="org">Google LLC</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:d@domenic.me" class="email">d@domenic.me</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Jeremy Roman</span></div>
<div dir="auto" class="left"><span class="org">Google LLC</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:jbroman@chromium.org" class="email">jbroman@chromium.org</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
